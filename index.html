<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>èˆªç©ºåœ°å‹¤ç–²å‹é¢¨éšªåˆ†æç³»çµ± (FRAS) - å­¸è¡“ç ”ç©¶å°ˆæ¥­ç‰ˆ</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
    <style>
        /* åŸºç¤æ¨£å¼ */
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', 'Microsoft JhengHei', sans-serif;
        }
        
        body {
            background-color: #f5f8fa;
            color: #333;
            line-height: 1.6;
            padding: 20px;
            max-width: 1200px;
            margin: 0 auto;
        }
        
        /* å­¸è¡“è«–æ–‡é¢¨æ ¼æ¨™é¡Œ */
        .thesis-title {
            background: linear-gradient(to right, #1a3c8b, #2c5aa0);
            color: white;
            padding: 20px 30px;
            border-radius: 5px;
            margin-bottom: 25px;
            font-size: 1.8rem;
            font-weight: 600;
            text-align: center;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            border-left: 8px solid #ffc107;
        }
        
        .thesis-subtitle {
            background-color: #2c5aa0;
            color: white;
            padding: 12px 20px;
            border-radius: 3px;
            margin: 20px 0 15px 0;
            font-size: 1.3rem;
            font-weight: 500;
            border-left: 5px solid #ffc107;
        }
        
        .section-number {
            background-color: #ffc107;
            color: #1a3c8b;
            font-weight: bold;
            padding: 3px 10px;
            border-radius: 3px;
            margin-right: 10px;
        }
        
        /* ç ”ç©¶æ–¹æ³•å€å¡Šæ¨£å¼ */
        .research-method-section {
            background-color: #f8f9fa;
            border-left: 5px solid #1a3c8b;
            padding: 25px;
            margin-bottom: 30px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            border-radius: 5px;
        }
        
        .method-box {
            background-color: white;
            border: 1px solid #d1d9e6;
            padding: 20px;
            margin: 15px 0;
            border-radius: 5px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.03);
        }
        
        .method-title {
            color: #1a3c8b;
            font-weight: 600;
            margin-bottom: 10px;
            font-size: 1.1rem;
            border-bottom: 1px solid #eee;
            padding-bottom: 8px;
        }
        
        .method-content {
            font-size: 0.95rem;
            line-height: 1.7;
            color: #444;
        }
        
        /* è¡¨æ ¼æ¨£å¼ */
        .thesis-table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            font-size: 0.9rem;
            background-color: white;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        
        .thesis-table th {
            background-color: #e8eef7;
            border: 1px solid #b0c4de;
            padding: 10px 12px;
            font-weight: 600;
            text-align: center;
            color: #1a3c8b;
        }
        
        .thesis-table td {
            border: 1px solid #b0c4de;
            padding: 8px 12px;
            text-align: center;
        }
        
        .thesis-table tr:nth-child(even) {
            background-color: #f8fafd;
        }
        
        .thesis-table tr:hover {
            background-color: #e8f0fe;
            cursor: pointer;
        }
        
        /* åˆ†æçµæœå€å¡Š */
        .analysis-output {
            background-color: white;
            border-left: 5px solid #1a3c8b;
            padding: 25px;
            margin-bottom: 25px;
            box-shadow: 0 3px 12px rgba(0,0,0,0.08);
            border-radius: 5px;
        }
        
        .output-title {
            color: #1a3c8b;
            font-weight: 600;
            margin-bottom: 20px;
            font-size: 1.25rem;
            padding-bottom: 10px;
            border-bottom: 1px solid #e0e0e0;
        }
        
        /* ä¿®æ­£çš„åœ–è¡¨å®¹å™¨æ¨£å¼ - ä½¿ç”¨Flexä½ˆå±€ */
        .chart-container {
            background-color: white;
            padding: 20px;
            margin: 20px 0;
            border: 1px solid #d1d9e6;
            border-radius: 5px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
            min-height: 450px;
            height: auto;
            display: flex;
            flex-direction: column;
            position: relative;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .chart-container:hover {
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            border-color: #2c5aa0;
            transform: translateY(-2px);
        }
        
        .chart-title {
            font-weight: 600;
            color: #1a3c8b;
            margin-bottom: 15px;
            text-align: center;
            font-size: 1.1rem;
            flex-shrink: 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .chart-title-text {
            flex: 1;
            text-align: center;
        }
        
        .chart-click-hint {
            background-color: #e8eef7;
            color: #1a3c8b;
            font-size: 0.8rem;
            padding: 4px 10px;
            border-radius: 15px;
            margin-left: 10px;
            font-weight: normal;
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0% { background-color: #e8eef7; }
            50% { background-color: #d4e1f7; }
            100% { background-color: #e8eef7; }
        }
        
        /* åœ–è¡¨ç•«å¸ƒå®¹å™¨ - å›ºå®šé«˜åº¦ */
        .chart-canvas-container {
            flex: 1;
            min-height: 250px;
            position: relative;
            margin-bottom: 10px;
        }
        
        /* ä¿®æ­£çš„åœ–è¡¨è¨»é‡‹ - ç¢ºä¿ä¸è¢«è¦†è“‹ */
        .chart-note {
            background-color: #f8f9fa;
            border-left: 4px solid #1a3c8b;
            padding: 15px;
            margin-top: 10px;
            font-size: 0.85rem;
            color: #495057;
            font-style: italic;
            border-radius: 3px;
            width: 100%;
            box-sizing: border-box;
            flex-shrink: 0;
            z-index: 10;
        }
        
        /* çµ±è¨ˆæ¨™ç±¤ */
        .stat-label {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 3px;
            font-size: 0.8rem;
            font-weight: 600;
            margin: 0 3px;
        }
        
        .stat-low {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .stat-medium {
            background-color: #fff3cd;
            color: #856404;
            border: 1px solid #ffeaa7;
        }
        
        .stat-high {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        /* ä¸Šå‚³å€åŸŸ */
        .upload-area {
            border: 2px dashed #1a3c8b;
            background-color: #f8fafd;
            padding: 50px 20px;
            text-align: center;
            border-radius: 5px;
            margin: 20px 0;
            transition: all 0.3s;
            cursor: pointer;
        }
        
        .upload-area:hover {
            background-color: #e8eef7;
            border-color: #2c5aa0;
        }
        
        .upload-area.dragover {
            background-color: #d4e1f7;
            border-color: #2c5aa0;
            border-style: solid;
        }
        
        /* æŒ‰éˆ•æ¨£å¼ */
        .thesis-button {
            background-color: #1a3c8b;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 3px;
            cursor: pointer;
            font-size: 0.95rem;
            font-weight: 500;
            transition: background-color 0.2s;
            margin: 5px;
        }
        
        .thesis-button:hover {
            background-color: #2c5aa0;
        }
        
        .thesis-button-secondary {
            background-color: #6c757d;
        }
        
        .thesis-button-secondary:hover {
            background-color: #5a6268;
        }
        
        /* éš±è—é¡åˆ¥ */
        .hidden {
            display: none;
        }
        
        /* é å°¾ */
        footer {
            text-align: center;
            margin-top: 50px;
            padding-top: 25px;
            border-top: 1px solid #ddd;
            color: #6c757d;
            font-size: 0.85rem;
            line-height: 1.5;
        }
        
        /* éŸ¿æ‡‰å¼è¨­è¨ˆ */
        @media (max-width: 768px) {
            body {
                padding: 10px;
            }
            
            .thesis-table {
                font-size: 0.8rem;
            }
            
            .thesis-table th, .thesis-table td {
                padding: 6px 8px;
            }
            
            .analysis-output {
                padding: 15px;
            }
            
            .research-method-section {
                padding: 15px;
            }
            
            .chart-container {
                min-height: 500px; /* æ‰‹æ©Ÿä¸Šç¨é«˜ */
            }
            
            .chart-canvas-container {
                min-height: 300px;
            }
            
            .chart-click-hint {
                font-size: 0.7rem;
                padding: 3px 8px;
                margin-left: 5px;
            }
        }
        
        /* ç ”ç©¶æµç¨‹åœ–æ¨£å¼ */
        .research-flow {
            display: flex;
            flex-wrap: wrap;
            justify-content: space-between;
            margin: 25px 0;
        }
        
        .flow-step {
            flex: 1;
            min-width: 200px;
            background-color: white;
            border: 1px solid #d1d9e6;
            padding: 15px;
            margin: 10px;
            border-radius: 5px;
            text-align: center;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }
        
        .flow-number {
            background-color: #1a3c8b;
            color: white;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 10px auto;
            font-weight: bold;
        }
        
        .flow-title {
            font-weight: 600;
            color: #1a3c8b;
            margin-bottom: 8px;
            font-size: 1rem;
        }
        
        /* é€²åº¦æ¢æ¨£å¼ */
        .progress-container {
            width: 100%;
            background-color: #e9ecef;
            border-radius: 3px;
            height: 12px;
            margin: 20px 0;
        }
        
        .progress-bar {
            height: 100%;
            background: linear-gradient(to right, #1a3c8b, #2c5aa0);
            border-radius: 3px;
            transition: width 0.5s;
        }
        
        /* äººå“¡è©³ç´°è³‡æ–™å½ˆå‡ºå±¤ */
        .person-detail-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            z-index: 1000;
            overflow-y: auto;
        }
        
        .person-detail-content {
            background-color: white;
            margin: 50px auto;
            padding: 30px;
            border-radius: 8px;
            width: 90%;
            max-width: 900px;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 5px 20px rgba(0,0,0,0.2);
        }
        
        .person-detail-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid #ddd;
        }
        
        .person-detail-title {
            font-size: 1.4rem;
            color: #1a3c8b;
            font-weight: 600;
        }
        
        .close-modal {
            background-color: #6c757d;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.9rem;
        }
        
        .person-detail-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 25px;
        }
        
        .person-detail-card {
            background-color: #f8f9fa;
            padding: 15px;
            border-radius: 6px;
            border-left: 4px solid #1a3c8b;
        }
        
        .detail-card-title {
            font-weight: 600;
            color: #495057;
            margin-bottom: 5px;
            font-size: 0.9rem;
        }
        
        .detail-card-value {
            font-size: 1.3rem;
            font-weight: 700;
            color: #1a3c8b;
        }
        
        .person-timeline {
            margin: 20px 0;
        }
        
        .timeline-title {
            font-weight: 600;
            color: #1a3c8b;
            margin-bottom: 10px;
        }
        
        .timeline-items {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 10px;
        }
        
        .timeline-item {
            padding: 6px 12px;
            background-color: #e8eef7;
            border-radius: 4px;
            font-size: 0.85rem;
        }
        
        /* åœ–è¡¨ç¶²æ ¼å¸ƒå±€ */
        .chart-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(550px, 1fr));
            gap: 20px;
            margin-top: 15px;
        }
        
        @media (max-width: 1100px) {
            .chart-grid {
                grid-template-columns: 1fr;
            }
        }
        
        /* åœ–è¡¨è©³ç´°è³‡æ–™å½ˆå‡ºå±¤ */
        .chart-detail-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            z-index: 1001;
            overflow-y: auto;
        }
        
        .chart-detail-content {
            background-color: white;
            margin: 50px auto;
            padding: 30px;
            border-radius: 8px;
            width: 90%;
            max-width: 900px;
            max-height: 85vh;
            overflow-y: auto;
            box-shadow: 0 5px 20px rgba(0,0,0,0.2);
        }
        
        .chart-detail-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 1px solid #ddd;
        }
        
        .chart-detail-title {
            font-size: 1.5rem;
            color: #1a3c8b;
            font-weight: 600;
        }
        
        .chart-detail-body {
            margin-bottom: 25px;
        }
        
        .chart-detail-section {
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 1px solid #eee;
        }
        
        .chart-detail-section-title {
            font-weight: 600;
            color: #1a3c8b;
            margin-bottom: 15px;
            font-size: 1.2rem;
            display: flex;
            align-items: center;
        }
        
        .chart-detail-icon {
            background-color: #1a3c8b;
            color: white;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 10px;
            font-weight: bold;
            font-size: 0.9rem;
        }
        
        .chart-detail-text {
            font-size: 1rem;
            line-height: 1.6;
            color: #444;
            margin-bottom: 10px;
        }
        
        .chart-detail-list {
            padding-left: 20px;
            margin-bottom: 15px;
        }
        
        .chart-detail-list li {
            margin-bottom: 8px;
            line-height: 1.5;
        }
        
        .chart-detail-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }
        
        .chart-detail-card {
            background-color: #f8f9fa;
            padding: 15px;
            border-radius: 6px;
            border-left: 4px solid #1a3c8b;
        }
        
        .chart-detail-card-title {
            font-weight: 600;
            color: #495057;
            margin-bottom: 5px;
            font-size: 0.9rem;
        }
        
        .chart-detail-card-value {
            font-size: 1.2rem;
            font-weight: 700;
            color: #1a3c8b;
        }
        
        .chart-detail-chart-container {
            background-color: white;
            padding: 15px;
            border: 1px solid #d1d9e6;
            border-radius: 5px;
            margin: 20px 0;
            height: 300px;
        }
        
        /* æ”¹å–„å»ºè­°æ¨£å¼ */
        .improvement-suggestion {
            background-color: #e8f4ff;
            border-left: 5px solid #2c5aa0;
            padding: 15px;
            margin: 15px 0;
            border-radius: 3px;
        }
        
        .improvement-title {
            font-weight: 600;
            color: #1a3c8b;
            margin-bottom: 8px;
            font-size: 1rem;
        }
        
        .improvement-content {
            font-size: 0.95rem;
            line-height: 1.6;
            color: #444;
        }
    </style>
</head>
<body>
    <!-- è«–æ–‡æ¨™é¡Œå€ -->
    <div class="thesis-title">
        èˆªç©ºåœ°å‹¤ç–²å‹é¢¨éšªåˆ†æç³»çµ± (FRAS) - å­¸è¡“ç ”ç©¶å°ˆæ¥­ç‰ˆ
        <div style="font-size: 1rem; margin-top: 10px; font-weight: 400; color: #e8f4ff;">
            åŸºæ–¼æ··åˆç ”ç©¶æ³•ä¹‹ç–²å‹é¢¨éšªé‡åŒ–åˆ†æå·¥å…·
        </div>
    </div>
    
    <!-- ä¸»å…§å®¹å€ -->
    <main>
        <!-- ç ”ç©¶æ–¹æ³•æ¦‚è¿°å€å¡Š -->
        <section id="research-methods">
            <div class="thesis-subtitle">
                <span class="section-number">ç¬¬ä¸‰ç« </span> ç ”ç©¶æ–¹æ³•æ¦‚è¿°
            </div>
            
            <div class="research-method-section">
                <div class="method-box">
                    <div class="method-title">3.1 ç ”ç©¶æ–¹æ³•æ¦‚è¿°</div>
                    <div class="method-content">
                        <p>æœ¬ç ”ç©¶æ—¨åœ¨æ¢è¨ C å…¬å¸é«˜é›„åœæ©Ÿç·šç¶­ä¿®äººå“¡åœ¨ç¾è¡Œè¼ªç­åˆ¶åº¦ä¸‹çš„ç–²å‹é¢¨éšªèˆ‡å…¶å°ç¶­ä¿®ç¸¾æ•ˆä¹‹å½±éŸ¿ã€‚é‘‘æ–¼ç–²å‹è­°é¡Œæ¶‰åŠç”Ÿç†æ•¸æ“šçš„å®¢è§€äº‹å¯¦èˆ‡å€‹äººæ„ŸçŸ¥çš„äº¤äº’ä½œç”¨ï¼Œå–®ä¸€ç ”ç©¶æ–¹æ³•é›£ä»¥çªºè¦‹å…¨è²Œã€‚å› æ­¤ï¼Œæœ¬ç ”ç©¶æ¡ç”¨ã€Œæ··åˆç ”ç©¶æ³•ï¼ˆMixed-Methods Researchï¼‰ã€ï¼Œçµåˆã€Œæª”æ¡ˆç ”ç©¶æ³•ï¼ˆArchival Researchï¼‰ã€é€²è¡Œé‡åŒ–æ•¸æ“šåˆ†æï¼Œä»¥åŠã€Œå°ˆå®¶è¨ªè«‡æ³•ï¼ˆExpert Interviewï¼‰ã€é€²è¡Œè³ªæ€§æ¢è¨ã€‚ç ”ç©¶é‚è¼¯ç‚ºã€Œæ•¸æ“šå…ˆè¡Œï¼Œè¨ªè«‡é©—è­‰ã€ã€‚é¦–å…ˆé€éæ’ç­è¡¨çš„å®¢è§€æ•¸æ“šè­˜åˆ¥é«˜é¢¨éšªç–²å‹æ¨¡å¼ï¼Œå†é€éå°ˆå®¶è¨ªè«‡æ·±å…¥æŒ–æ˜æ•¸æ“šèƒŒå¾Œçš„åˆ¶åº¦æˆå› èˆ‡ç¾å ´å¯¦å‹™å›°å¢ƒï¼Œæœ€å¾Œé€²è¡Œç¶œåˆæ¯”è¼ƒåˆ†æã€‚</p>
                    </div>
                </div>
            </div>
        </section>
        
        <!-- è³‡æ–™ä¸Šå‚³èˆ‡åˆ†æå€å¡Š -->
        <section id="data-analysis">
            <div class="thesis-subtitle">
                <span class="section-number">3.2</span> æ’ç­è¡¨æ•¸æ“šè’é›†èˆ‡é‡åŒ–åˆ†æ
            </div>
            
            <div class="research-method-section">
                <div class="method-box">
                    <div class="method-title">æª”æ¡ˆä¸Šå‚³èˆ‡è‡ªå‹•åˆ†æ</div>
                    <div class="method-content">
                        <p>è«‹ä¸Šå‚³ C å…¬å¸é«˜é›„åœæ©Ÿç·šçš„æ’ç­è¡¨CSVæª”æ¡ˆã€‚ç³»çµ±å°‡è‡ªå‹•åŸ·è¡Œé‡åŒ–åˆ†æï¼Œè¨ˆç®—ä»¥ä¸‹æŒ‡æ¨™ï¼š</p>
                        <ul>
                            <li>é€£çºŒå·¥ä½œæ—¥æ•¸ï¼ˆé•åå‹åŸºæ³•ç¬¬36æ¢ä¹‹é¢¨éšªï¼‰</li>
                            <li>å¤œç­/æ—©ç­æ¯”ä¾‹ï¼ˆç”Ÿç†ç¯€å¾‹å¹²æ“¾åº¦ï¼‰</li>
                            <li>ç­æ¬¡é–“éš”æ™‚é–“ï¼ˆä¼‘æ¯å……åˆ†æ€§ï¼‰</li>
                            <li>å·¥ä½œè² è·æŒ‡æ¨™ï¼ˆäººæ©Ÿæ¯”èˆ‡å°–å³°æ™‚æ®µè² è·ï¼‰</li>
                            <li>ç–²å‹é¢¨éšªæŒ‡æ•¸ï¼ˆFRIï¼‰ç¶œåˆè©•åˆ†</li>
                        </ul>
                        
                        <div class="upload-area" id="drop-area">
                            <p style="font-size: 1.1rem; margin-bottom: 15px;">ğŸ“ <strong>æ‹–æ”¾CSVæª”æ¡ˆè‡³æ­¤å€åŸŸï¼Œæˆ–é»æ“Šé¸æ“‡æª”æ¡ˆ</strong></p>
                            <p style="margin-bottom: 20px; color: #666; font-size: 0.95rem;">
                                æª”æ¡ˆæ ¼å¼ï¼šæ‡‰åŒ…å«ã€Œæ—¥æœŸã€äººå“¡ã€äººå“¡é¡å‹ã€æ©Ÿè™Ÿã€STA/STDã€ä¾†è‡ª/é£›å¾€ã€ç­‰æ¬„ä½
                            </p>
                            
                            <div style="margin: 20px 0;">
                                <button class="thesis-button" id="select-file-btn">é¸æ“‡CSVæª”æ¡ˆ</button>
                                <input type="file" id="file-input" accept=".csv,text/csv" style="display: none;">
                            </div>
                            
                            <p style="font-size: 0.9rem; color: #666; margin-top: 15px;">
                                <strong>æ³¨æ„ï¼š</strong> ç³»çµ±å°‡è‡ªå‹•éæ¿¾ç„¡æ•ˆè¨˜éŒ„ï¼ˆåˆ†éš”ç·šã€çµ±è¨ˆåˆ—ï¼‰ï¼Œä¸¦é€²è¡Œè³‡æ–™å»è­˜åˆ¥åŒ–è™•ç†ï¼Œç¬¦åˆç ”ç©¶å€«ç†è¦æ±‚ã€‚
                            </p>
                        </div>
                        
                        <!-- è³‡æ–™é è¦½å€ï¼ˆè‡ªå‹•éš±è—ï¼‰ -->
                        <div id="data-preview-container" class="hidden">
                            <div style="margin-top: 25px; padding-top: 20px; border-top: 1px solid #eee;">
                                <div class="method-title" style="margin-bottom: 15px;">è³‡æ–™é è¦½ï¼ˆå‰10ç­†ï¼‰</div>
                                <div id="data-preview" style="max-height: 300px; overflow-y: auto; margin: 15px 0;"></div>
                                <div style="text-align: center; margin-top: 20px;">
                                    <button class="thesis-button-secondary" id="clear-data-btn">æ¸…é™¤è³‡æ–™</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- è¼‰å…¥æŒ‡ç¤ºå™¨ï¼ˆè‡ªå‹•éš±è—ï¼‰ -->
                <div id="loading-indicator" class="hidden">
                    <div class="method-box">
                        <div class="method-title">åˆ†æè™•ç†ä¸­</div>
                        <div class="method-content">
                            <p>æ­£åœ¨åŸ·è¡Œæª”æ¡ˆç ”ç©¶æ³•é‡åŒ–åˆ†æï¼Œè«‹ç¨å€™...</p>
                            <div class="progress-container">
                                <div id="progress-bar" class="progress-bar" style="width: 0%;"></div>
                            </div>
                            <p id="progress-text" style="text-align: center; margin-top: 10px; font-size: 0.9rem;">åˆå§‹åŒ–åˆ†æå¼•æ“...</p>
                        </div>
                    </div>
                </div>
            </div>
        </section>
        
        <!-- åˆ†æçµæœå€å¡Šï¼ˆè‡ªå‹•é¡¯ç¤ºï¼‰ -->
        <section id="analysis-results-section" class="hidden">
            <div class="thesis-subtitle">
                <span class="section-number">3.4</span> é‡åŒ–åˆ†æçµæœ
            </div>
            
            <div class="research-method-section">
                <!-- æ¡ˆä¾‹è™•ç†æ‘˜è¦ -->
                <div id="case-summary" class="analysis-output">
                    <div class="output-title">æ¡ˆä¾‹è™•ç†æ‘˜è¦</div>
                    <table class="thesis-table">
                        <thead>
                            <tr>
                                <th>é …ç›®</th>
                                <th>æœ‰æ•ˆæ¡ˆä¾‹æ•¸</th>
                                <th>æ’é™¤æ¡ˆä¾‹æ•¸</th>
                                <th>ç¸½è¨ˆ</th>
                                <th>ç™¾åˆ†æ¯” (%)</th>
                            </tr>
                        </thead>
                        <tbody id="case-summary-body"></tbody>
                    </table>
                    <div class="chart-note">
                        è¨»ï¼šç³»çµ±å·²è‡ªå‹•éæ¿¾ç„¡æ•ˆè¨˜éŒ„ï¼ˆå¦‚åˆ†éš”ç·šã€çµ±è¨ˆåˆ—ã€éäººåç­‰ï¼‰ï¼Œç¬¦åˆæª”æ¡ˆç ”ç©¶æ³•ä¹‹è³‡æ–™æ¸…æ´—æ¨™æº–ã€‚
                    </div>
                </div>
                
                <!-- æè¿°æ€§çµ±è¨ˆé‡ -->
                <div id="descriptive-stats" class="analysis-output">
                    <div class="output-title">æè¿°æ€§çµ±è¨ˆé‡</div>
                    <table class="thesis-table">
                        <thead>
                            <tr>
                                <th rowspan="2">è®Šæ•¸</th>
                                <th colspan="3">é›†ä¸­è¶¨å‹¢</th>
                                <th colspan="3">é›¢æ•£è¶¨å‹¢</th>
                                <th rowspan="2">æœ€å°å€¼</th>
                                <th rowspan="2">æœ€å¤§å€¼</th>
                            </tr>
                            <tr>
                                <th>å¹³å‡æ•¸</th>
                                <th>ä¸­ä½æ•¸</th>
                                <th>çœ¾æ•¸</th>
                                <th>æ¨™æº–å·®</th>
                                <th>è®Šç•°æ•¸</th>
                                <th>ç¯„åœ</th>
                            </tr>
                        </thead>
                        <tbody id="descriptive-stats-body"></tbody>
                    </table>
                </div>
                
                <!-- ç–²å‹é¢¨éšªæŒ‡æ•¸åˆ†æ -->
                <div id="fri-analysis" class="analysis-output">
                    <div class="output-title">ç–²å‹é¢¨éšªæŒ‡æ•¸ (FRI) åˆ†æ</div>
                    
                    <div class="chart-grid">
                        <div class="chart-container" data-chart-id="friDistributionChart" id="chart-container-1">
                            <div class="chart-title">
                                <span class="chart-title-text">åœ–1ï¼šç–²å‹é¢¨éšªæŒ‡æ•¸åˆ†ä½ˆåœ–</span>
                                <span class="chart-click-hint">é»æ“ŠæŸ¥çœ‹è©³ç´°åˆ†æ</span>
                            </div>
                            <div class="chart-canvas-container">
                                <canvas id="friDistributionChart"></canvas>
                            </div>
                            <div class="chart-note">
                                <strong>è«–æ–‡é€£çµï¼š</strong> æ­¤åœ–å°æ‡‰è«–æ–‡ã€Œ3.1.1 æª”æ¡ˆç ”ç©¶æ³•ï¼ˆé‡åŒ–åˆ†æï¼‰ã€ä¸­ã€Œè­˜åˆ¥é«˜é¢¨éšªç–²å‹æ¨¡å¼ã€ä¹‹ç›®çš„ã€‚<br>
                                <strong>è§£è®€æ–¹å¼ï¼š</strong> é¡¯ç¤ºäººå“¡ç–²å‹é¢¨éšªåˆ†ä½ˆæƒ…æ³ï¼Œé«˜é¢¨éšªäººå“¡éœ€å„ªå…ˆå®‰æ’å°ˆå®¶è¨ªè«‡ï¼Œé©—è­‰é‡åŒ–çµæœã€‚
                            </div>
                        </div>
                        
                        <div class="chart-container" data-chart-id="friConsecutiveChart" id="chart-container-2">
                            <div class="chart-title">
                                <span class="chart-title-text">åœ–2ï¼šFRIèˆ‡é€£çºŒå·¥ä½œå¤©æ•¸é—œè¯åœ–</span>
                                <span class="chart-click-hint">é»æ“ŠæŸ¥çœ‹è©³ç´°åˆ†æ</span>
                            </div>
                            <div class="chart-canvas-container">
                                <canvas id="friConsecutiveChart"></canvas>
                            </div>
                            <div class="chart-note">
                                <strong>è«–æ–‡é€£çµï¼š</strong> æ­¤åœ–å°æ‡‰è«–æ–‡ã€Œ3.3.1 æ’ç­è¡¨æ•¸æ“šè™•ç†ã€ä¸­ã€Œå·¥æ™‚èˆ‡ç­æ¬¡åˆ†æã€ä¹‹é€£çºŒå·¥ä½œæ—¥æ•¸è¨ˆç®—ã€‚<br>
                                <strong>è§£è®€æ–¹å¼ï¼š</strong> å±•ç¤ºFRIåˆ†æ•¸èˆ‡é€£çºŒå·¥ä½œå¤©æ•¸çš„é—œè¯æ€§ï¼Œé©—è­‰é€£çºŒå·¥ä½œå°ç–²å‹çš„ç´¯ç©æ•ˆæ‡‰ã€‚
                            </div>
                        </div>
                    </div>
                    
                    <table class="thesis-table">
                        <thead>
                            <tr>
                                <th>é¢¨éšªç­‰ç´š</th>
                                <th>æ¬¡æ•¸</th>
                                <th>ç™¾åˆ†æ¯” (%)</th>
                                <th>æœ‰æ•ˆç™¾åˆ†æ¯” (%)</th>
                                <th>ç´¯ç©ç™¾åˆ†æ¯” (%)</th>
                                <th>å»ºè­°æªæ–½</th>
                            </tr>
                        </thead>
                        <tbody id="fri-distribution-body"></tbody>
                    </table>
                </div>
                
                <!-- é€£çºŒå·¥ä½œå¤©æ•¸åˆ†æ -->
                <div id="consecutive-days-analysis" class="analysis-output">
                    <div class="output-title">é€£çºŒå·¥ä½œå¤©æ•¸åˆ†æï¼ˆå‹åŸºæ³•ç¬¬36æ¢ç¬¦åˆæ€§ï¼‰</div>
                    
                    <div class="chart-grid">
                        <div class="chart-container" data-chart-id="consecutiveDaysChart" id="chart-container-3">
                            <div class="chart-title">
                                <span class="chart-title-text">åœ–3ï¼šé€£çºŒå·¥ä½œå¤©æ•¸åˆ†ä½ˆåœ–</span>
                                <span class="chart-click-hint">é»æ“ŠæŸ¥çœ‹è©³ç´°åˆ†æ</span>
                            </div>
                            <div class="chart-canvas-container">
                                <canvas id="consecutiveDaysChart"></canvas>
                            </div>
                            <div class="chart-note">
                                <strong>è«–æ–‡é€£çµï¼š</strong> æ­¤åœ–å°æ‡‰è«–æ–‡ã€Œ3.3.1 æ’ç­è¡¨æ•¸æ“šè™•ç†ã€ä¸­ã€Œå·¥æ™‚èˆ‡ç­æ¬¡åˆ†æã€æ§‹é¢ï¼Œè©•ä¼°æ³•è¦ç¬¦åˆæ€§ã€‚<br>
                                <strong>è§£è®€æ–¹å¼ï¼š</strong> é¡¯ç¤ºé€£çºŒå·¥ä½œå¤©æ•¸åˆ†ä½ˆï¼Œç´…ç·šæ¨™ç¤ºæ³•è¦ä¸Šé™ï¼ˆ6å¤©ï¼‰ï¼Œè¶…éæ­¤é™å³é•åå‹åŸºæ³•ç¬¬36æ¢ã€‚
                            </div>
                        </div>
                        
                        <div class="chart-container" data-chart-id="nightShiftChart" id="chart-container-4">
                            <div class="chart-title">
                                <span class="chart-title-text">åœ–4ï¼šå¤œç­é »ç‡èˆ‡ç–²å‹é¢¨éšªé—œè¯åœ–</span>
                                <span class="chart-click-hint">é»æ“ŠæŸ¥çœ‹è©³ç´°åˆ†æ</span>
                            </div>
                            <div class="chart-canvas-container">
                                <canvas id="nightShiftChart"></canvas>
                            </div>
                            <div class="chart-note">
                                <strong>è«–æ–‡é€£çµï¼š</strong> æ­¤åœ–å°æ‡‰è«–æ–‡ã€Œ3.3.1 æ’ç­è¡¨æ•¸æ“šè™•ç†ã€ä¸­ã€Œç”Ÿç†ç¯€å¾‹å¹²æ“¾åº¦ã€è©•ä¼°ã€‚<br>
                                <strong>è§£è®€æ–¹å¼ï¼š</strong> å±•ç¤ºå¤œç­é »ç‡èˆ‡ç–²å‹é¢¨éšªæŒ‡æ•¸çš„é—œä¿‚ï¼Œé©—è­‰å¤œç­ä½œæ¥­å°ç”Ÿç†ç¯€å¾‹çš„å¹²æ“¾æ•ˆæ‡‰ã€‚
                            </div>
                        </div>
                    </div>
                    
                    <table class="thesis-table">
                        <thead>
                            <tr>
                                <th>é€£çºŒå¤©æ•¸</th>
                                <th>æ¬¡æ•¸</th>
                                <th>ç™¾åˆ†æ¯” (%)</th>
                                <th>æœ‰æ•ˆç™¾åˆ†æ¯” (%)</th>
                                <th>ç´¯ç©ç™¾åˆ†æ¯” (%)</th>
                                <th>æ³•è¦ç¬¦åˆæ€§</th>
                            </tr>
                        </thead>
                        <tbody id="consecutive-days-body"></tbody>
                    </table>
                    
                    <div class="chart-note">
                        æ ¹æ“šã€Šå‹å‹•åŸºæº–æ³•ã€‹ç¬¬36æ¢ï¼Œå‹å·¥æ¯7æ—¥ä¸­æ‡‰æœ‰2æ—¥ä¹‹ä¼‘æ¯ï¼Œå…¶ä¸­1æ—¥ç‚ºä¾‹å‡ï¼Œ1æ—¥ç‚ºä¼‘æ¯æ—¥ã€‚é€£çºŒå·¥ä½œè¶…é6å¤©å³é•åæ³•è¦ã€‚
                    </div>
                </div>
                
                <!-- å·¥ä½œè² è·åˆ†æ -->
                <div id="workload-analysis" class="analysis-output">
                    <div class="output-title">å·¥ä½œè² è·åˆ†æï¼ˆäººæ©Ÿæ¯”è©•ä¼°ï¼‰</div>
                    
                    <div class="chart-grid">
                        <div class="chart-container" data-chart-id="workloadTrendChart" id="chart-container-5">
                            <div class="chart-title">
                                <span class="chart-title-text">åœ–5ï¼šå·¥ä½œè² è·æ™‚é–“åºåˆ—åœ–</span>
                                <span class="chart-click-hint">é»æ“ŠæŸ¥çœ‹è©³ç´°åˆ†æ</span>
                            </div>
                            <div class="chart-canvas-container">
                                <canvas id="workloadTrendChart"></canvas>
                            </div>
                            <div class="chart-note">
                                <strong>è«–æ–‡é€£çµï¼š</strong> æ­¤åœ–å°æ‡‰è«–æ–‡ã€Œ3.3.1 æ’ç­è¡¨æ•¸æ“šè™•ç†ã€ä¸­ã€Œå·¥ä½œè² è·è©•ä¼°ã€æ§‹é¢ï¼Œè¨ˆç®—å°–å³°æ™‚æ®µè² è·åº¦ã€‚<br>
                                <strong>è§£è®€æ–¹å¼ï¼š</strong> å±•ç¤ºå·¥ä½œé‡éš¨æ™‚é–“è®ŠåŒ–è¶¨å‹¢ï¼Œè­˜åˆ¥å°–å³°æ™‚æ®µï¼ˆç´…è‰²å€åŸŸï¼‰ï¼Œä½œç‚ºæ’ç­å„ªåŒ–ä¾æ“šã€‚
                            </div>
                        </div>
                        
                        <div class="chart-container" data-chart-id="shiftTypeChart" id="chart-container-6">
                            <div class="chart-title">
                                <span class="chart-title-text">åœ–6ï¼šç­å‹åˆ†ä½ˆåœ“é¤…åœ–</span>
                                <span class="chart-click-hint">é»æ“ŠæŸ¥çœ‹è©³ç´°åˆ†æ</span>
                            </div>
                            <div class="chart-canvas-container">
                                <canvas id="shiftTypeChart"></canvas>
                            </div>
                            <div class="chart-note">
                                <strong>è«–æ–‡é€£çµï¼š</strong> æ­¤åœ–å°æ‡‰è«–æ–‡ã€Œ3.3.1 æ’ç­è¡¨æ•¸æ“šè™•ç†ã€ä¸­ã€Œå·¥æ™‚èˆ‡ç­æ¬¡åˆ†æã€ä¹‹ç­å‹åˆ†ä½ˆã€‚<br>
                                <strong>è§£è®€æ–¹å¼ï¼š</strong> é¡¯ç¤ºå„é¡ç­å‹æ¯”ä¾‹ï¼Œå¤œç­ï¼ˆç´…è‰²ï¼‰æ¯”ä¾‹éé«˜æœƒå¢åŠ ç”Ÿç†ç¯€å¾‹å¹²æ“¾ï¼Œéœ€ç‰¹åˆ¥é—œæ³¨ã€‚
                            </div>
                        </div>
                    </div>
                    
                    <table class="thesis-table" id="workload-table">
                        <thead>
                            <tr>
                                <th>äººå“¡</th>
                                <th>å·¥ä½œå¤©æ•¸</th>
                                <th>ç¸½èˆªç­æ•¸</th>
                                <th>å¹³å‡æ¯æ—¥èˆªç­</th>
                                <th>å–®æ—¥æœ€é«˜èˆªç­</th>
                                <th>å¤œç­æ¬¡æ•¸</th>
                                <th>FRIåˆ†æ•¸</th>
                                <th>é¢¨éšªç­‰ç´š</th>
                            </tr>
                        </thead>
                        <tbody id="workload-table-body"></tbody>
                    </table>
                    
                    <div class="chart-note">
                        <strong>æ“ä½œèªªæ˜ï¼š</strong> é»æ“Šè¡¨æ ¼ä¸­ä»»ä¸€äººå“¡åˆ—ï¼Œå¯æŸ¥çœ‹è©²äººå“¡è©³ç´°å·¥ä½œè¨˜éŒ„èˆ‡ç–²å‹é¢¨éšªåˆ†æã€‚
                    </div>
                </div>
                
                <!-- ç›¸é—œæ€§åˆ†æ -->
                <div id="correlation-analysis" class="analysis-output">
                    <div class="output-title">ç›¸é—œæ€§åˆ†æï¼ˆè®Šæ•¸é–“é—œè¯æ€§ï¼‰</div>
                    
                    <table class="thesis-table">
                        <thead>
                            <tr>
                                <th>è®Šæ•¸</th>
                                <th>å·¥ä½œå¤©æ•¸</th>
                                <th>å¹³å‡æ¯æ—¥èˆªç­</th>
                                <th>æœ€å¤§é€£çºŒå·¥ä½œå¤©æ•¸</th>
                                <th>å¤œç­æ¯”ä¾‹</th>
                                <th>FRIåˆ†æ•¸</th>
                            </tr>
                        </thead>
                        <tbody id="correlation-table-body"></tbody>
                    </table>
                    
                    <div class="chart-note">
                        è¨»ï¼šè¡¨æ ¼ä¸­æ•¸å€¼ç‚ºPearsonç›¸é—œä¿‚æ•¸ï¼Œ**è¡¨ç¤ºp < .01ï¼ˆé«˜åº¦é¡¯è‘—ï¼‰ï¼Œ*è¡¨ç¤ºp < .05ï¼ˆé¡¯è‘—ï¼‰ã€‚
                    </div>
                </div>
                
                <!-- ç ”ç©¶çµè«–èˆ‡å»ºè­° -->
                <div id="research-conclusions" class="analysis-output">
                    <div class="output-title">ç ”ç©¶çµè«–èˆ‡å»ºè­°</div>
                    
                    <div class="method-box">
                        <div class="method-title">é‡åŒ–åˆ†æç™¼ç¾</div>
                        <div class="method-content">
                            <div id="quantitative-findings"></div>
                        </div>
                    </div>
                    
                    <div class="method-box">
                        <div class="method-title">è³ªæ€§ç ”ç©¶éŠœæ¥å»ºè­°</div>
                        <div class="method-content">
                            <p>åŸºæ–¼é‡åŒ–åˆ†æçµæœï¼Œå»ºè­°å°ˆå®¶è¨ªè«‡èšç„¦ä»¥ä¸‹è­°é¡Œï¼š</p>
                            <ol>
                                <li><strong>é«˜ç–²å‹é¢¨éšªäººå“¡è¨ªè«‡ï¼š</strong> é‡å°FRIåˆ†æ•¸â‰¥70ä¹‹äººå“¡ï¼Œæ·±å…¥äº†è§£å…¶ä¸»è§€ç–²å‹æ„Ÿå—èˆ‡ä½œæ¥­å“è³ªå½±éŸ¿ã€‚</li>
                                <li><strong>é€£çºŒå·¥ä½œè­°é¡Œï¼š</strong> æ¢è¨é€£çºŒå·¥ä½œè¶…é6å¤©çš„å¯¦éš›æƒ…æ³èˆ‡ç®¡ç†å› ç´ ã€‚</li>
                                <li><strong>å¤œç­ä½œæ¥­ç¶“é©—ï¼š</strong> æ”¶é›†å¤œç­ä½œæ¥­çš„å¯¦å‹™å›°é›£èˆ‡æ”¹å–„å»ºè­°ã€‚</li>
                                <li><strong>æ’ç­åˆ¶åº¦æª¢è¨ï¼š</strong> æ¢è¨ç¾è¡Œæ’ç­åˆ¶åº¦çš„äººå› å·¥ç¨‹å•é¡Œèˆ‡æ”¹å–„ç©ºé–“ã€‚</li>
                            </ol>
                        </div>
                    </div>
                    
                    <div class="method-box">
                        <div class="method-title">è³‡æ–™è¼¸å‡ºé¸é …</div>
                        <div class="method-content">
                            <div style="text-align: center; margin: 20px 0;">
                                <button class="thesis-button" id="export-report-btn">åŒ¯å‡ºåˆ†æå ±å‘Š (DOCX)</button>
                                <button class="thesis-button" id="export-data-btn">åŒ¯å‡ºåˆ†æè³‡æ–™ (SPSSæ ¼å¼)</button>
                                <button class="thesis-button" id="export-charts-btn">åŒ¯å‡ºåœ–è¡¨ (PNG)</button>
                                <button class="thesis-button-secondary" id="reset-analysis-btn">é‡æ–°åˆ†æ</button>
                            </div>
                            
                            <div class="chart-note">
                                è¨»ï¼šæ‰€æœ‰è¼¸å‡ºè³‡æ–™å‡å·²é€²è¡Œå»è­˜åˆ¥åŒ–è™•ç†ï¼Œç¬¦åˆç ”ç©¶å€«ç†è¦æ±‚ã€‚
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </main>
    
    <!-- äººå“¡è©³ç´°è³‡æ–™å½ˆå‡ºå±¤ -->
    <div id="person-detail-modal" class="person-detail-modal">
        <div class="person-detail-content">
            <div class="person-detail-header">
                <div class="person-detail-title" id="person-detail-name"></div>
                <button class="close-modal" id="close-modal-btn">é—œé–‰</button>
            </div>
            
            <div class="person-detail-grid" id="person-detail-metrics"></div>
            
            <div class="person-timeline">
                <div class="timeline-title">å·¥ä½œæ—¥æœŸæ™‚é–“è»¸</div>
                <div class="timeline-items" id="person-work-dates"></div>
            </div>
            
            <div style="margin-top: 25px;">
                <div class="timeline-title">åŸå§‹èˆªç­è³‡æ–™</div>
                <div id="person-raw-data" style="max-height: 300px; overflow-y: auto; margin-top: 10px;"></div>
            </div>
            
            <div class="chart-note" style="margin-top: 20px;">
                <strong>å°ˆå®¶è¨ªè«‡å»ºè­°ï¼š</strong> æ­¤äººå“¡å› <span id="interview-reason"></span>ï¼Œå»ºè­°ç´å…¥å°ˆå®¶è¨ªè«‡å°è±¡ï¼Œæ·±å…¥äº†è§£å…¶ç–²å‹æ„Ÿå—èˆ‡å¯¦å‹™å›°é›£ã€‚
            </div>
        </div>
    </div>
    
    <!-- åœ–è¡¨è©³ç´°è³‡æ–™å½ˆå‡ºå±¤ -->
    <div id="chart-detail-modal" class="chart-detail-modal">
        <div class="chart-detail-content">
            <div class="chart-detail-header">
                <div class="chart-detail-title" id="chart-detail-title"></div>
                <button class="close-modal" id="close-chart-modal-btn">é—œé–‰</button>
            </div>
            
            <div class="chart-detail-body">
                <div class="chart-detail-chart-container">
                    <canvas id="chart-detail-chart"></canvas>
                </div>
                
                <div class="chart-detail-section">
                    <div class="chart-detail-section-title">
                        <div class="chart-detail-icon">1</div>
                        <span>åœ–è¡¨ç›®çš„èˆ‡è«–æ–‡é€£çµ</span>
                    </div>
                    <div class="chart-detail-text" id="chart-purpose"></div>
                </div>
                
                <div class="chart-detail-section">
                    <div class="chart-detail-section-title">
                        <div class="chart-detail-icon">2</div>
                        <span>è©³ç´°æ•¸æ“šè§£è®€</span>
                    </div>
                    <div class="chart-detail-text" id="chart-interpretation"></div>
                    <div class="chart-detail-grid" id="chart-data-grid"></div>
                </div>
                
                <div class="chart-detail-section">
                    <div class="chart-detail-section-title">
                        <div class="chart-detail-icon">3</div>
                        <span>å­¸è¡“åˆ†æèˆ‡è©•ä¼°</span>
                    </div>
                    <div class="chart-detail-text" id="chart-analysis"></div>
                </div>
                
                <div class="chart-detail-section">
                    <div class="chart-detail-section-title">
                        <div class="chart-detail-icon">4</div>
                        <span>å¯¦å‹™å»ºè­°èˆ‡æ”¹å–„æ–¹æ¡ˆ</span>
                    </div>
                    <div class="improvement-suggestion" id="chart-improvement"></div>
                </div>
                
                <div class="chart-detail-section">
                    <div class="chart-detail-section-title">
                        <div class="chart-detail-icon">5</div>
                        <span>å¾ŒçºŒç ”ç©¶æ–¹å‘</span>
                    </div>
                    <div class="chart-detail-text" id="chart-research"></div>
                </div>
            </div>
        </div>
    </div>
    
    <footer>
        <p><strong>èˆªç©ºåœ°å‹¤ç–²å‹é¢¨éšªåˆ†æç³»çµ± (FRAS) - å­¸è¡“ç ”ç©¶å°ˆæ¥­ç‰ˆ</strong></p>
        <p>åœ‹ç«‹æˆåŠŸå¤§å­¸äº¤é€šç®¡ç†ç§‘å­¸ç ”ç©¶æ‰€ç¢©å£«è«–æ–‡ç ”ç©¶å·¥å…·</p>
        <p>ç ”ç©¶æ–¹æ³•ï¼šæ··åˆç ”ç©¶æ³•ï¼ˆæª”æ¡ˆç ”ç©¶æ³• + å°ˆå®¶è¨ªè«‡æ³•ï¼‰</p>
        <p>Â© 2023 ç ”ç©¶å€«ç†å¯©æŸ¥é€šé | ç‰ˆæœ¬ 3.2 (åœ–è¡¨å„ªåŒ–ç‰ˆ)</p>
        <p style="margin-top: 10px; font-size: 0.8rem; color: #888;">
            è¨»ï¼šæœ¬ç³»çµ±ç¬¦åˆç ”ç©¶å€«ç†è¦æ±‚ï¼Œæ‰€æœ‰è³‡æ–™è™•ç†å‡é€²è¡Œå»è­˜åˆ¥åŒ–ï¼Œç¢ºä¿å€‹äººè³‡æ–™ä¿è­·ã€‚
        </p>
    </footer>
    
    <script>
        // å…¨åŸŸè®Šæ•¸
        let rawData = [];
        let analysisResults = {};
        let charts = {};
        let inferredYear = new Date().getFullYear();
        let chartDetailInfo = {};
        
        // DOMå…ƒç´ 
        const dropArea = document.getElementById('drop-area');
        const fileInput = document.getElementById('file-input');
        const selectFileBtn = document.getElementById('select-file-btn');
        const clearDataBtn = document.getElementById('clear-data-btn');
        const dataPreviewContainer = document.getElementById('data-preview-container');
        const dataPreview = document.getElementById('data-preview');
        const analysisResultsSection = document.getElementById('analysis-results-section');
        const loadingIndicator = document.getElementById('loading-indicator');
        const progressBar = document.getElementById('progress-bar');
        const progressText = document.getElementById('progress-text');
        const personDetailModal = document.getElementById('person-detail-modal');
        const closeModalBtn = document.getElementById('close-modal-btn');
        const chartDetailModal = document.getElementById('chart-detail-modal');
        const closeChartModalBtn = document.getElementById('close-chart-modal-btn');
        
        // åœ–è¡¨è©³ç´°è³‡æ–™
        const chartDetails = {
            friDistributionChart: {
                title: "åœ–1ï¼šç–²å‹é¢¨éšªæŒ‡æ•¸åˆ†ä½ˆåœ–",
                purpose: "æ­¤åœ–æ—¨åœ¨å±•ç¤ºé«˜é›„åœæ©Ÿç·šç¶­ä¿®äººå“¡ç–²å‹é¢¨éšªçš„åˆ†ä½ˆç‹€æ³ï¼Œæ˜¯æœ¬ç ”ç©¶é‡åŒ–åˆ†æçš„æ ¸å¿ƒæˆæœã€‚é€éç–²å‹é¢¨éšªæŒ‡æ•¸(FRI)çš„è¨ˆç®—ï¼Œå°‡äººå“¡åˆ†ç‚ºä½ã€ä¸­ã€é«˜ä¸‰å€‹é¢¨éšªç­‰ç´šï¼Œç›´è§€å‘ˆç¾çµ„ç¹”å…§ç–²å‹é¢¨éšªçš„æ•´é«”åˆ†ä½ˆå½¢æ…‹ã€‚",
                interpretation: "åœ–è¡¨é¡¯ç¤ºä½é¢¨éšªäººå“¡ï¼ˆFRI<50ï¼‰ä½”<span class='stat-label stat-low'>{{lowPercent}}%</span>ï¼Œä¸­é¢¨éšªäººå“¡ï¼ˆ50â‰¤FRI<70ï¼‰ä½”<span class='stat-label stat-medium'>{{mediumPercent}}%</span>ï¼Œé«˜é¢¨éšªäººå“¡ï¼ˆFRIâ‰¥70ï¼‰ä½”<span class='stat-label stat-high'>{{highPercent}}%</span>ã€‚é«˜é¢¨éšªäººå“¡æ¯”ä¾‹è‹¥è¶…é15%ï¼Œè¡¨ç¤ºçµ„ç¹”å­˜åœ¨é¡¯è‘—çš„ç–²å‹ç®¡ç†å•é¡Œã€‚",
                analysis: "å¾äººå› å·¥ç¨‹å­¸è§’åº¦ï¼Œé«˜ç–²å‹é¢¨éšªæœƒå°è‡´æ³¨æ„åŠ›ä¸‹é™ã€åæ‡‰æ™‚é–“å»¶é•·å’Œæ±ºç­–å“è³ªæƒ¡åŒ–ã€‚åœ¨èˆªç©ºç¶­ä¿®ä½œæ¥­ä¸­ï¼Œé€™äº›å½±éŸ¿å¯èƒ½ç›´æ¥è½‰åŒ–ç‚ºå®‰å…¨é¢¨éšªã€‚æ ¹æ“šReasonçš„ç‘å£«ä¹³é…ªæ¨¡å‹ï¼Œç–²å‹æ˜¯å°è‡´äººç‚ºéŒ¯èª¤çš„é‡è¦æ½›åœ¨å› å­ã€‚æœ¬åœ–é¡¯ç¤ºçš„é«˜é¢¨éšªäººå“¡æ‡‰è¢«è¦–ç‚ºå®‰å…¨é—œéµé»ï¼Œéœ€å„ªå…ˆä»‹å…¥ç®¡ç†ã€‚",
                improvement: "é‡å°é«˜é¢¨éšªäººå“¡ï¼š1. ç«‹å³èª¿æ•´æ’ç­ï¼Œå¢åŠ é€£çºŒä¼‘æ¯å¤©æ•¸ï¼›2. å¯¦æ–½ç–²å‹ç®¡ç†åŸ¹è¨“ï¼›3. å»ºç«‹ç–²å‹è‡ªæˆ‘å ±å‘Šæ©Ÿåˆ¶ï¼›4. å®šæœŸé€²è¡Œç–²å‹é¢¨éšªå†è©•ä¼°ã€‚é‡å°ä¸­é¢¨éšªäººå“¡ï¼š1. é©åº¦èª¿æ•´å·¥ä½œè² è·ï¼›2. æä¾›å£“åŠ›ç®¡ç†è³‡æºï¼›3. åŠ å¼·ä¸»ç®¡å°ç–²å‹å¾µå…†çš„è­˜åˆ¥èƒ½åŠ›ã€‚",
                research: "å¾ŒçºŒå¯çµåˆç”Ÿç‰©æŒ‡æ¨™ï¼ˆå¦‚å¿ƒç‡è®Šç•°æ€§ã€çš®è³ªé†‡æ°´å¹³ï¼‰é©—è­‰FRIåˆ†æ•¸çš„æ•ˆåº¦ï¼Œä¸¦ç™¼å±•ç–²å‹é æ¸¬æ¨¡å‹ï¼Œå¯¦ç¾ç–²å‹é¢¨éšªçš„ä¸»å‹•ç®¡ç†ã€‚"
            },
            friConsecutiveChart: {
                title: "åœ–2ï¼šFRIèˆ‡é€£çºŒå·¥ä½œå¤©æ•¸é—œè¯åœ–",
                purpose: "æ­¤åœ–æ¢è¨é€£çºŒå·¥ä½œå¤©æ•¸èˆ‡ç–²å‹é¢¨éšªæŒ‡æ•¸çš„é—œè¯æ€§ï¼Œé©—è­‰ã€Œé€£çºŒå·¥ä½œå¤©æ•¸è¶Šé•·ï¼Œç–²å‹é¢¨éšªè¶Šé«˜ã€çš„ç ”ç©¶å‡è¨­ã€‚åœ–ä¸­é›™Yè»¸è¨­è¨ˆåŒæ™‚å±•ç¤ºFRIåˆ†æ•¸ï¼ˆå·¦è»¸ï¼‰èˆ‡é€£çºŒå·¥ä½œå¤©æ•¸ï¼ˆå³è»¸ï¼‰çš„è®ŠåŒ–è¶¨å‹¢ã€‚",
                interpretation: "åœ–è¡¨é¡¯ç¤ºFRIåˆ†æ•¸èˆ‡é€£çºŒå·¥ä½œå¤©æ•¸å‘ˆç¾<span class='stat-label {{correlationClass}}'>{{correlationStrength}}</span>ç›¸é—œæ€§ï¼ˆr={{correlationValue}}ï¼‰ã€‚å‰{{topCount}}åé«˜é¢¨éšªäººå“¡ä¸­ï¼Œæœ‰{{highConsecutiveCount}}äººé€£çºŒå·¥ä½œå¤©æ•¸è¶…é5å¤©ï¼Œé¡¯ç¤ºé€£çºŒå·¥ä½œå°ç–²å‹æœ‰é¡¯è‘—ç´¯ç©æ•ˆæ‡‰ã€‚",
                analysis: "æ ¹æ“šæ¢å¾©ç†è«–ï¼Œé€£çºŒå·¥ä½œæœƒæ¸›å°‘ç”Ÿç†èˆ‡å¿ƒç†çš„æ¢å¾©æ™‚é–“ï¼Œå°è‡´ç–²å‹ç´¯ç©ã€‚æœ¬ç ”ç©¶ç™¼ç¾é€£çºŒå·¥ä½œå¤©æ•¸èˆ‡FRIåˆ†æ•¸çš„ç›¸é—œæ€§ç¬¦åˆç–²å‹ç´¯ç©æ¨¡å‹ã€‚ç‰¹åˆ¥å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œç•¶é€£çºŒå·¥ä½œè¶…é4å¤©æ™‚ï¼ŒFRIåˆ†æ•¸æœ‰æ˜é¡¯ä¸Šå‡è¶¨å‹¢ï¼Œé€™å¯èƒ½åæ˜ äº†äººé«”ç”Ÿç†ç¯€å¾‹çš„æ¥µé™ã€‚",
                improvement: "1. å¯¦æ–½ã€Œé€£çºŒå·¥ä½œå¤©æ•¸ä¸Šé™ã€æ”¿ç­–ï¼Œå»ºè­°ä¸è¶…é4å¤©ï¼›2. åœ¨é€£çºŒå·¥ä½œ3å¤©å¾Œå®‰æ’è‡³å°‘1å¤©å®Œæ•´ä¼‘æ¯ï¼›3. é‡å°é«˜é€£çºŒå·¥ä½œå¤©æ•¸äººå“¡å¯¦æ–½ç–²å‹ç›£æ¸¬ï¼›4. èª¿æ•´æ’ç­é‚è¼¯ï¼Œé¿å…äººå“¡é€£çºŒå¤šæ—¥å·¥ä½œã€‚",
                research: "æœªä¾†ç ”ç©¶å¯æ¢è¨ä¸åŒé€£çºŒå·¥ä½œæ¨¡å¼ï¼ˆå¦‚æ—©ç­æ¥å¤œç­ï¼‰å°ç–²å‹çš„å·®ç•°å½±éŸ¿ï¼Œä¸¦å»ºç«‹é€£çºŒå·¥ä½œç–²å‹å‡½æ•¸ï¼Œç‚ºæ’ç­å„ªåŒ–æä¾›æ•¸å­¸æ¨¡å‹åŸºç¤ã€‚"
            },
            consecutiveDaysChart: {
                title: "åœ–3ï¼šé€£çºŒå·¥ä½œå¤©æ•¸åˆ†ä½ˆåœ–",
                purpose: "æ­¤åœ–è©•ä¼°ç¾è¡Œæ’ç­åˆ¶åº¦èˆ‡ã€Šå‹å‹•åŸºæº–æ³•ã€‹ç¬¬36æ¢çš„ç¬¦åˆæ€§ï¼Œåˆ†æé€£çºŒå·¥ä½œå¤©æ•¸çš„åˆ†ä½ˆç‹€æ³ã€‚åœ–ä¸­ç´…è‰²è™›ç·šæ¨™ç¤ºæ³•è¦ä¸Šé™ï¼ˆ6å¤©ï¼‰ï¼Œè¶…éæ­¤é™å³é•åå‹åŸºæ³•è¦å®šã€‚",
                interpretation: "æ•¸æ“šé¡¯ç¤ºæœ‰<span class='stat-label stat-high'>{{nonCompliantCount}}äººï¼ˆ{{nonCompliantPercent}}%ï¼‰</span>é€£çºŒå·¥ä½œè¶…é6å¤©ï¼Œé•åå‹åŸºæ³•è¦å®šã€‚é€£çºŒå·¥ä½œ5-6å¤©çš„äººå“¡ä½”<span class='stat-label stat-medium'>{{mediumRiskPercent}}%</span>ï¼Œé›–ç„¶ç¬¦åˆæ³•è¦ä½†å·²æ¥è¿‘ä¸Šé™ã€‚æœ€å¸¸è¦‹çš„é€£çºŒå·¥ä½œå¤©æ•¸ç‚º{{mostCommonDays}}å¤©ã€‚",
                analysis: "å¾æ³•è¦éµå¾ªè§’åº¦ï¼Œ{{complianceRate}}%çš„æ³•è¦ç¬¦åˆç‡é¡¯ç¤ºæ’ç­åˆ¶åº¦å­˜åœ¨æ”¹é€²ç©ºé–“ã€‚é€£çºŒå·¥ä½œè¶…é6å¤©ä¸åƒ…é•æ³•ï¼Œä¹Ÿé•åç–²å‹ç®¡ç†çš„æœ€ä½³å¯¦å‹™ã€‚å¾å®‰å…¨ç®¡ç†ç³»çµ±(SMS)è§€é»ï¼Œé€™å±¬æ–¼å±éšªæºçš„ç³»çµ±æ€§å¤±æ•ˆï¼Œéœ€è¦çµ„ç¹”å±¤ç´šçš„ä»‹å…¥ã€‚",
                improvement: "1. ç«‹å³ä¿®æ­£é•æ³•æ’ç­ï¼Œç¢ºä¿æ‰€æœ‰æ’ç­ç¬¦åˆå‹åŸºæ³•ï¼›2. å»ºç«‹æ’ç­å¯©æŸ¥æ©Ÿåˆ¶ï¼Œç”±äººåŠ›è³‡æºéƒ¨é–€å®šæœŸæª¢æŸ¥ï¼›3. å¯¦æ–½é›»å­æ’ç­ç³»çµ±ï¼Œè‡ªå‹•æª¢æŸ¥æ³•è¦ç¬¦åˆæ€§ï¼›4. å°ä¸»ç®¡é€²è¡Œå‹åŸºæ³•åŸ¹è¨“ï¼Œæå‡æ³•è¦æ„è­˜ã€‚",
                research: "å¯é€²ä¸€æ­¥ç ”ç©¶æ³•è¦ç¬¦åˆæ€§èˆ‡å®‰å…¨äº‹ä»¶çš„ç›¸é—œæ€§ï¼Œä¸¦æ¯”è¼ƒä¸åŒèˆªç©ºå…¬å¸çš„æ’ç­åˆ¶åº¦èˆ‡æ³•è¦éµå¾ªç‹€æ³ï¼Œæå‡ºç”¢æ¥­æœ€ä½³å¯¦å‹™å»ºè­°ã€‚"
            },
            nightShiftChart: {
                title: "åœ–4ï¼šå¤œç­é »ç‡èˆ‡ç–²å‹é¢¨éšªé—œè¯åœ–",
                purpose: "æ­¤åœ–æ¢è¨å¤œç­é »ç‡èˆ‡ç–²å‹é¢¨éšªçš„é—œä¿‚ï¼Œé©—è­‰å¤œç­ä½œæ¥­å°ç”Ÿç†ç¯€å¾‹çš„å¹²æ“¾æ•ˆæ‡‰ã€‚æ•£é»åœ–è¨­è¨ˆå¯è§€å¯Ÿå€‹åˆ¥äººå“¡çš„å¤œç­é »ç‡èˆ‡FRIåˆ†æ•¸åˆ†ä½ˆï¼Œä¸¦è­˜åˆ¥ç•°å¸¸å€‹æ¡ˆã€‚",
                interpretation: "åœ–è¡¨é¡¯ç¤ºå¤œç­é »ç‡èˆ‡FRIåˆ†æ•¸å‘ˆç¾<span class='stat-label {{nightCorrelationClass}}'>{{nightCorrelationStrength}}</span>ç›¸é—œæ€§ï¼ˆr={{nightCorrelationValue}}ï¼‰ã€‚å¤œç­é »ç‡è¶…é30%çš„äººå“¡ä¸­ï¼Œæœ‰{{highNightRiskPercent}}%å±¬æ–¼é«˜ç–²å‹é¢¨éšªã€‚æœ€æ¥µç«¯å€‹æ¡ˆç‚º{{extremeCase}}ï¼Œå¤œç­é »ç‡é«˜é”{{extremeNightPercent}}%ï¼ŒFRIåˆ†æ•¸{{extremeFriScore}}ã€‚",
                analysis: "å¤œç­ä½œæ¥­æœƒå¹²æ“¾ç”Ÿç†ç¯€å¾‹ï¼Œå½±éŸ¿ç¡çœ å“è³ªèˆ‡æ¢å¾©æ•ˆç‡ã€‚æœ¬ç ”ç©¶çµæœæ”¯æŒå¤œç­é »ç‡èˆ‡ç–²å‹é¢¨éšªçš„æ­£ç›¸é—œï¼Œç¬¦åˆå¤œç­ç–²å‹çš„æ–‡ç»ç™¼ç¾ã€‚å¾èˆªç©ºå®‰å…¨è§’åº¦ï¼Œå¤œç­äººå“¡çš„èªçŸ¥åŠŸèƒ½ä¸‹é™å¯èƒ½å½±éŸ¿ç¶­ä¿®ä½œæ¥­çš„æº–ç¢ºæ€§ï¼Œéœ€è¦ç‰¹åˆ¥é—œæ³¨ã€‚",
                improvement: "1. å¯¦æ–½å¤œç­é »ç‡ä¸Šé™ï¼Œå»ºè­°æ¯æœˆä¸è¶…é8ç­ï¼›2. æä¾›å¤œç­äººå“¡å°ˆå±¬ä¼‘æ¯è¨­æ–½ï¼›3. å»ºç«‹å¤œç­ç–²å‹ç›£æ¸¬æ©Ÿåˆ¶ï¼›4. èª¿æ•´å¤œç­ä½œæ¥­ç¨‹åºï¼Œå¢åŠ æª¢æŸ¥é»èˆ‡é›™é‡ç¢ºèªï¼›5. æä¾›å¤œç­ç‡Ÿé¤Šèˆ‡å¥åº·æŒ‡å°ã€‚",
                research: "æœªä¾†å¯æ¡ç”¨æ›´ç²¾ç¢ºçš„ç”Ÿç†æ¸¬é‡ï¼ˆå¦‚é«”æº«ã€è¤ªé»‘æ¿€ç´ æ°´å¹³ï¼‰è©•ä¼°å¤œç­å°ç”Ÿç†ç¯€å¾‹çš„å¯¦éš›å½±éŸ¿ï¼Œä¸¦ç ”ç©¶ä¸åŒå¤œç­è¼ªè½‰æ¨¡å¼ï¼ˆå¦‚å¿«é€Ÿè¼ªè½‰vsæ…¢é€Ÿè¼ªè½‰ï¼‰çš„ç–²å‹å·®ç•°ã€‚"
            },
            workloadTrendChart: {
                title: "åœ–5ï¼šå·¥ä½œè² è·æ™‚é–“åºåˆ—åœ–",
                purpose: "æ­¤åœ–å±•ç¤ºå·¥ä½œé‡éš¨æ™‚é–“çš„è®ŠåŒ–è¶¨å‹¢ï¼Œè­˜åˆ¥å°–å³°èˆ‡é›¢å³°æ™‚æ®µï¼Œç‚ºæ’ç­å„ªåŒ–èˆ‡è³‡æºé…ç½®æä¾›æ•¸æ“šæ”¯æŒã€‚åœ–ä¸­åŒ…å«å¹³å‡å·¥ä½œé‡ç·šèˆ‡å°–å³°é–¾å€¼ç·šï¼Œæœ‰åŠ©æ–¼è¦–è¦ºåŒ–è¾¨è­˜é«˜è² è·æœŸé–“ã€‚",
                interpretation: "å·¥ä½œé‡åœ¨{{peakMonths}}é”åˆ°å°–å³°ï¼Œæœ€é«˜å·¥ä½œé‡ç‚º{{maxWorkload}}èˆªç­ï¼Œè¼ƒå¹³å‡å€¼é«˜å‡º{{peakIncrease}}%ã€‚{{offPeakMonths}}ç‚ºé›¢å³°æœŸï¼Œå·¥ä½œé‡è¼ƒä½ã€‚å°–å³°æœŸé–“çš„å·¥ä½œé‡è¶…éé–¾å€¼å¤©æ•¸ä½”{{peakDaysPercent}}%ï¼Œé¡¯ç¤ºå­˜åœ¨æ˜é¡¯çš„å­£ç¯€æ€§æ³¢å‹•ã€‚",
                analysis: "å·¥ä½œè² è·çš„æ™‚é–“ä¸å‡å‹»åˆ†ä½ˆæœƒå°è‡´è³‡æºé…ç½®æ•ˆç‡ä½ä¸‹èˆ‡äººå“¡ç–²å‹ã€‚å°–å³°æœŸé–“çš„é«˜è² è·å¯èƒ½å°è‡´æª¢æŸ¥æ™‚é–“å£“ç¸®ã€ä½œæ¥­å“è³ªä¸‹é™ã€‚å¾æ’ç­å„ªåŒ–è§’åº¦ï¼Œè­˜åˆ¥å°–å³°æ¨¡å¼æœ‰åŠ©æ–¼é å…ˆè¦åŠƒäººåŠ›ï¼Œé¿å…ç–²å‹ç´¯ç©ã€‚",
                improvement: "1. æ ¹æ“šæ­·å²æ•¸æ“šé æ¸¬å°–å³°æœŸï¼Œæå‰èª¿æ•´äººåŠ›é…ç½®ï¼›2. å¯¦æ–½å½ˆæ€§æ’ç­åˆ¶åº¦ï¼Œå°–å³°æœŸå¢åŠ å‚™å‹¤äººåŠ›ï¼›3. å»ºç«‹å·¥ä½œé‡ç›£æ¸¬ç³»çµ±ï¼Œå³æ™‚èª¿æ•´è³‡æºåˆ†é…ï¼›4. å„ªåŒ–ä½œæ¥­æµç¨‹ï¼Œæå‡å°–å³°æœŸä½œæ¥­æ•ˆç‡ï¼›5. è€ƒæ…®å¤–åŒ…æˆ–è·¨éƒ¨é–€æ”¯æ´æ©Ÿåˆ¶ã€‚",
                research: "å¯æ‡‰ç”¨æ™‚é–“åºåˆ—åˆ†æé æ¸¬æœªä¾†å·¥ä½œé‡è¶¨å‹¢ï¼Œä¸¦çµåˆå¤©æ°£ã€èˆªç­æ™‚åˆ»ç­‰å¤–éƒ¨è®Šæ•¸å»ºç«‹å·¥ä½œé‡é æ¸¬æ¨¡å‹ï¼Œå¯¦ç¾æ™ºæ…§åŒ–æ’ç­ã€‚"
            },
            shiftTypeChart: {
                title: "åœ–6ï¼šç­å‹åˆ†ä½ˆåœ“é¤…åœ–",
                purpose: "æ­¤åœ–åˆ†æä¸åŒç­å‹ï¼ˆæ—©ç­ã€æ™šç­ã€å¤œç­ã€æ—¥ç­ï¼‰çš„åˆ†é…æ¯”ä¾‹ï¼Œè©•ä¼°ç­å‹çµæ§‹å°ç–²å‹é¢¨éšªçš„æ½›åœ¨å½±éŸ¿ã€‚ä¸åŒé¡è‰²æ¨™ç¤ºä¸åŒç­å‹ï¼Œå¤œç­ä»¥ç´…è‰²å¼·èª¿å…¶é«˜é¢¨éšªç‰¹æ€§ã€‚",
                interpretation: "å¤œç­æ¯”ä¾‹ç‚º<span class='stat-label {{nightShiftClass}}'>{{nightShiftPercent}}%</span>ï¼Œ{{nightShiftAssessment}}ã€‚æ—©ç­ä½”{{morningShiftPercent}}%ï¼Œæ™šç­ä½”{{eveningShiftPercent}}%ï¼Œæ—¥ç­ä½”{{dayShiftPercent}}%ã€‚æœ€å¸¸è¦‹çš„ç­å‹çµ„åˆç‚º{{commonShiftCombo}}ã€‚",
                analysis: "ç­å‹åˆ†ä½ˆåæ˜ çµ„ç¹”çš„ä½œæ¥­æ¨¡å¼èˆ‡ç–²å‹é¢¨éšªç‰¹å¾µã€‚å¤œç­æ¯”ä¾‹éé«˜æœƒå°è‡´é›†é«”ç–²å‹ï¼Œå½±éŸ¿çµ„ç¹”æ•´é«”çš„å®‰å…¨æ–‡åŒ–ã€‚å¾äººå› å·¥ç¨‹è§’åº¦ï¼Œç†æƒ³çš„ç­å‹æ‡‰æ¸›å°‘å¤œç­é »ç‡ï¼Œä¸¦é¿å…å¿«é€Ÿçš„ç­å‹è½‰æ›ã€‚",
                improvement: "1. é™ä½å¤œç­æ¯”ä¾‹ï¼Œç›®æ¨™æ§åˆ¶åœ¨15%ä»¥ä¸‹ï¼›2. å„ªåŒ–ç­å‹è¼ªè½‰é †åºï¼ˆå¦‚æ—©ç­â†’æ™šç­â†’å¤œç­â†’ä¼‘æ¯ï¼‰ï¼›3. å¯¦æ–½ç­å‹åå¥½èª¿æŸ¥ï¼Œå°‡å€‹äººåå¥½ç´å…¥æ’ç­è€ƒé‡ï¼›4. å»ºç«‹ç­å‹ç–²å‹è©•ä¼°æ©Ÿåˆ¶ï¼Œå®šæœŸå¯©æŸ¥ç­å‹è¨­è¨ˆï¼›5. æä¾›ä¸åŒç­å‹çš„å·®ç•°åŒ–ç–²å‹ç®¡ç†æªæ–½ã€‚",
                research: "å¯é€²ä¸€æ­¥ç ”ç©¶ç­å‹è¨­è¨ˆèˆ‡ç¡çœ å“è³ªã€å·¥ä½œæ»¿æ„åº¦çš„é—œä¿‚ï¼Œä¸¦æ¯”è¼ƒä¸åŒèˆªç©ºå…¬å¸çš„ç­å‹è¨­è¨ˆæ¨¡å¼ï¼Œæå‡ºç¬¦åˆèˆªç©ºç¶­ä¿®ç‰¹æ€§çš„æœ€ä½³ç­å‹è¨­è¨ˆåŸå‰‡ã€‚"
            }
        };
        
        // åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            console.log('å­¸è¡“ç ”ç©¶ç‰ˆFRASç³»çµ±å·²è¼‰å…¥');
            
            // äº‹ä»¶ç›£è½å™¨
            selectFileBtn.addEventListener('click', () => fileInput.click());
            fileInput.addEventListener('change', handleFileSelect);
            
            // æ‹–æ”¾åŠŸèƒ½
            dropArea.addEventListener('dragover', (e) => {
                e.preventDefault();
                dropArea.classList.add('dragover');
            });
            
            dropArea.addEventListener('dragleave', () => {
                dropArea.classList.remove('dragover');
            });
            
            dropArea.addEventListener('drop', (e) => {
                e.preventDefault();
                dropArea.classList.remove('dragover');
                
                if (e.dataTransfer.files.length) {
                    fileInput.files = e.dataTransfer.files;
                    handleFileSelect();
                }
            });
            
            // æ¸…é™¤è³‡æ–™æŒ‰éˆ•
            document.getElementById('clear-data-btn').addEventListener('click', clearData);
            
            // è¼¸å‡ºæŒ‰éˆ•
            document.getElementById('export-report-btn').addEventListener('click', exportReport);
            document.getElementById('export-data-btn').addEventListener('click', exportSPSSData);
            document.getElementById('export-charts-btn').addEventListener('click', exportCharts);
            document.getElementById('reset-analysis-btn').addEventListener('click', resetAnalysis);
            
            // äººå“¡è©³ç´°è³‡æ–™å½ˆå‡ºå±¤
            closeModalBtn.addEventListener('click', () => {
                personDetailModal.style.display = 'none';
            });
            
            // åœ–è¡¨è©³ç´°è³‡æ–™å½ˆå‡ºå±¤
            closeChartModalBtn.addEventListener('click', () => {
                chartDetailModal.style.display = 'none';
            });
            
            // é»æ“Šå½ˆå‡ºå±¤å¤–éƒ¨é—œé–‰
            window.addEventListener('click', (e) => {
                if (e.target === personDetailModal) {
                    personDetailModal.style.display = 'none';
                }
                if (e.target === chartDetailModal) {
                    chartDetailModal.style.display = 'none';
                }
            });
            
            // ç‚ºåœ–è¡¨å®¹å™¨æ·»åŠ é»æ“Šäº‹ä»¶ï¼ˆä½¿ç”¨äº‹ä»¶å§”è¨—ï¼‰
            document.addEventListener('click', function(e) {
                const chartContainer = e.target.closest('.chart-container');
                if (chartContainer) {
                    const chartId = chartContainer.getAttribute('data-chart-id');
                    if (chartId) {
                        showChartDetail(chartId);
                    }
                }
            });
        });
        
        // é¡¯ç¤ºåœ–è¡¨è©³ç´°è³‡æ–™
        function showChartDetail(chartId) {
            if (!charts[chartId]) {
                console.error('åœ–è¡¨æœªæ‰¾åˆ°:', chartId);
                return;
            }
            
            // æº–å‚™åœ–è¡¨è©³ç´°è³‡æ–™
            const detailTemplate = chartDetails[chartId];
            if (!detailTemplate) {
                console.error('åœ–è¡¨è©³ç´°è³‡æ–™æœªæ‰¾åˆ°:', chartId);
                return;
            }
            
            // æ ¹æ“šç•¶å‰æ•¸æ“šå¡«å……æ¨¡æ¿
            const filledDetail = fillChartDetailTemplate(chartId, detailTemplate);
            
            // æ›´æ–°å½ˆå‡ºå±¤å…§å®¹
            document.getElementById('chart-detail-title').textContent = filledDetail.title;
            document.getElementById('chart-purpose').innerHTML = filledDetail.purpose;
            document.getElementById('chart-interpretation').innerHTML = filledDetail.interpretation;
            document.getElementById('chart-analysis').innerHTML = filledDetail.analysis;
            document.getElementById('chart-improvement').innerHTML = `
                <div class="improvement-title">å¯¦å‹™æ”¹å–„å»ºè­°</div>
                <div class="improvement-content">${filledDetail.improvement}</div>
            `;
            document.getElementById('chart-research').innerHTML = filledDetail.research;
            
            // æ›´æ–°æ•¸æ“šç¶²æ ¼
            updateChartDataGrid(chartId);
            
            // åœ¨å½ˆå‡ºå±¤ä¸­é¡¯ç¤ºåœ–è¡¨
            const detailChartCanvas = document.getElementById('chart-detail-chart');
            const detailChartCtx = detailChartCanvas.getContext('2d');
            
            // éŠ·æ¯€ç¾æœ‰åœ–è¡¨
            if (chartDetailInfo.detailChart) {
                chartDetailInfo.detailChart.destroy();
            }
            
            // è¤‡è£½åŸå§‹åœ–è¡¨é…ç½®
            const originalChart = charts[chartId];
            const chartConfig = JSON.parse(JSON.stringify(originalChart.config));
            
            // èª¿æ•´åœ–è¡¨å¤§å°ä»¥é©æ‡‰å½ˆå‡ºå±¤
            chartDetailInfo.detailChart = new Chart(detailChartCtx, chartConfig);
            
            // é¡¯ç¤ºå½ˆå‡ºå±¤
            chartDetailModal.style.display = 'block';
        }
        
        // å¡«å……åœ–è¡¨è©³ç´°è³‡æ–™æ¨¡æ¿
        function fillChartDetailTemplate(chartId, template) {
            const result = { ...template };
            const dist = analysisResults.friDistribution;
            const total = dist.total;
            const correlation = analysisResults.correlationMatrix;
            const compliance = analysisResults.consecutiveDays.compliance;
            
            // æ ¹æ“šä¸åŒåœ–è¡¨å¡«å……æ•¸æ“š
            switch(chartId) {
                case 'friDistributionChart':
                    const lowPercent = ((dist.low / total) * 100).toFixed(1);
                    const mediumPercent = ((dist.medium / total) * 100).toFixed(1);
                    const highPercent = ((dist.high / total) * 100).toFixed(1);
                    
                    result.interpretation = result.interpretation
                        .replace('{{lowPercent}}', lowPercent)
                        .replace('{{mediumPercent}}', mediumPercent)
                        .replace('{{highPercent}}', highPercent);
                    break;
                    
                case 'friConsecutiveChart':
                    const correlationValue = correlation.consecutiveDays_friScore.toFixed(3);
                    const correlationStrength = Math.abs(correlation.consecutiveDays_friScore) >= 0.5 ? 'é«˜åº¦æ­£ç›¸é—œ' : 
                                               Math.abs(correlation.consecutiveDays_friScore) >= 0.3 ? 'ä¸­åº¦æ­£ç›¸é—œ' : 'ä½åº¦ç›¸é—œ';
                    const correlationClass = Math.abs(correlation.consecutiveDays_friScore) >= 0.5 ? 'stat-high' : 
                                            Math.abs(correlation.consecutiveDays_friScore) >= 0.3 ? 'stat-medium' : 'stat-low';
                    
                    // è¨ˆç®—å‰10åé«˜é¢¨éšªäººå“¡ä¸­é€£çºŒå·¥ä½œå¤©æ•¸è¶…é5å¤©çš„äººæ•¸
                    const workloadData = analysisResults.workloadData;
                    const top10 = workloadData.slice(0, 10);
                    const highConsecutiveCount = top10.filter(p => {
                        const person = analysisResults.people[p.name];
                        return person.maxConsecutiveDays > 5;
                    }).length;
                    
                    result.interpretation = result.interpretation
                        .replace('{{correlationValue}}', correlationValue)
                        .replace('{{correlationStrength}}', correlationStrength)
                        .replace('{{correlationClass}}', correlationClass)
                        .replace('{{topCount}}', '10')
                        .replace('{{highConsecutiveCount}}', highConsecutiveCount);
                    break;
                    
                case 'consecutiveDaysChart':
                    const nonCompliantCount = compliance.nonCompliant;
                    const nonCompliantPercent = compliance.complianceRate ? (100 - parseFloat(compliance.complianceRate)).toFixed(1) : '0.0';
                    const complianceRate = compliance.complianceRate || '0.0';
                    
                    // è¨ˆç®—é€£çºŒå·¥ä½œ5-6å¤©çš„äººæ•¸ç™¾åˆ†æ¯”
                    const people = Object.values(analysisResults.people);
                    const mediumRiskCount = people.filter(p => p.maxConsecutiveDays >= 5 && p.maxConsecutiveDays <= 6).length;
                    const mediumRiskPercent = ((mediumRiskCount / people.length) * 100).toFixed(1);
                    
                    // æ‰¾å‡ºæœ€å¸¸è¦‹çš„é€£çºŒå·¥ä½œå¤©æ•¸
                    const consecutiveDays = people.map(p => p.maxConsecutiveDays);
                    const frequency = {};
                    consecutiveDays.forEach(days => {
                        frequency[days] = (frequency[days] || 0) + 1;
                    });
                    let mostCommonDays = 0;
                    let maxFreq = 0;
                    Object.keys(frequency).forEach(days => {
                        if (frequency[days] > maxFreq) {
                            maxFreq = frequency[days];
                            mostCommonDays = days;
                        }
                    });
                    
                    result.interpretation = result.interpretation
                        .replace('{{nonCompliantCount}}', nonCompliantCount)
                        .replace('{{nonCompliantPercent}}', nonCompliantPercent)
                        .replace('{{mediumRiskPercent}}', mediumRiskPercent)
                        .replace('{{mostCommonDays}}', mostCommonDays)
                        .replace('{{complianceRate}}', complianceRate);
                    break;
                    
                case 'nightShiftChart':
                    const nightCorrelationValue = correlation.nightShiftRatio_friScore.toFixed(3);
                    const nightCorrelationStrength = Math.abs(correlation.nightShiftRatio_friScore) >= 0.5 ? 'é«˜åº¦æ­£ç›¸é—œ' : 
                                                    Math.abs(correlation.nightShiftRatio_friScore) >= 0.3 ? 'ä¸­åº¦æ­£ç›¸é—œ' : 'ä½åº¦ç›¸é—œ';
                    const nightCorrelationClass = Math.abs(correlation.nightShiftRatio_friScore) >= 0.5 ? 'stat-high' : 
                                                 Math.abs(correlation.nightShiftRatio_friScore) >= 0.3 ? 'stat-medium' : 'stat-low';
                    
                    // æ‰¾å‡ºå¤œç­é »ç‡è¶…é30%çš„é«˜é¢¨éšªäººå“¡
                    const highNightRiskCount = people.filter(p => 
                        p.nightShiftRatio > 0.3 && p.friScore >= 70
                    ).length;
                    const highNightRiskPercent = people.filter(p => p.nightShiftRatio > 0.3).length > 0 ? 
                        ((highNightRiskCount / people.filter(p => p.nightShiftRatio > 0.3).length) * 100).toFixed(1) : '0.0';
                    
                    // æ‰¾å‡ºæ¥µç«¯å€‹æ¡ˆ
                    let extremeCase = 'ç„¡';
                    let extremeNightPercent = '0';
                    let extremeFriScore = '0';
                    
                    if (people.length > 0) {
                        const sortedByNight = [...people].sort((a, b) => b.nightShiftRatio - a.nightShiftRatio);
                        if (sortedByNight[0].nightShiftRatio > 0) {
                            extremeCase = sortedByNight[0].name;
                            extremeNightPercent = (sortedByNight[0].nightShiftRatio * 100).toFixed(1);
                            extremeFriScore = sortedByNight[0].friScore;
                        }
                    }
                    
                    result.interpretation = result.interpretation
                        .replace('{{nightCorrelationValue}}', nightCorrelationValue)
                        .replace('{{nightCorrelationStrength}}', nightCorrelationStrength)
                        .replace('{{nightCorrelationClass}}', nightCorrelationClass)
                        .replace('{{highNightRiskPercent}}', highNightRiskPercent)
                        .replace('{{extremeCase}}', extremeCase)
                        .replace('{{extremeNightPercent}}', extremeNightPercent)
                        .replace('{{extremeFriScore}}', extremeFriScore);
                    break;
                    
                case 'workloadTrendChart':
                    // è¨ˆç®—æ¯æœˆå·¥ä½œé‡æ•¸æ“š
                    const monthlyWorkload = calculateMonthlyWorkload();
                    let peakMonths = '';
                    let maxWorkload = 0;
                    let peakIncrease = '0';
                    let offPeakMonths = '';
                    
                    if (monthlyWorkload.length > 0) {
                        // æ‰¾å‡ºå°–å³°æœˆä»½
                        const sortedByWorkload = [...monthlyWorkload].sort((a, b) => b.workload - a.workload);
                        peakMonths = sortedByWorkload.slice(0, 2).map(m => m.month).join('ã€');
                        maxWorkload = sortedByWorkload[0].workload;
                        
                        // è¨ˆç®—å¹³å‡å€¼
                        const avgWorkload = monthlyWorkload.reduce((sum, m) => sum + m.workload, 0) / monthlyWorkload.length;
                        peakIncrease = ((maxWorkload - avgWorkload) / avgWorkload * 100).toFixed(1);
                        
                        // æ‰¾å‡ºé›¢å³°æœˆä»½
                        const sortedAsc = [...monthlyWorkload].sort((a, b) => a.workload - b.workload);
                        offPeakMonths = sortedAsc.slice(0, 2).map(m => m.month).join('ã€');
                    }
                    
                    result.interpretation = result.interpretation
                        .replace('{{peakMonths}}', peakMonths || 'æœªçŸ¥æœˆä»½')
                        .replace('{{maxWorkload}}', maxWorkload || '0')
                        .replace('{{peakIncrease}}', peakIncrease)
                        .replace('{{offPeakMonths}}', offPeakMonths || 'æœªçŸ¥æœˆä»½')
                        .replace('{{peakDaysPercent}}', '30'); // ç°¡åŒ–ç‰ˆæœ¬
                    break;
                    
                case 'shiftTypeChart':
                    // è¨ˆç®—ç­å‹åˆ†ä½ˆ
                    const shiftTypesData = { 'æ—©ç­': 0, 'æ™šç­': 0, 'å¤œç­': 0, 'æ—¥ç­': 0 };
                    
                    Object.values(analysisResults.people).forEach(person => {
                        if (person.shiftTypes) {
                            Object.keys(person.shiftTypes).forEach(shiftType => {
                                if (shiftTypesData.hasOwnProperty(shiftType)) {
                                    shiftTypesData[shiftType] += person.shiftTypes[shiftType];
                                } else {
                                    shiftTypesData['æ—¥ç­'] += person.shiftTypes[shiftType];
                                }
                            });
                        }
                    });
                    
                    // è¨ˆç®—ç¸½èˆªç­æ•¸
                    const totalFlights = Object.values(shiftTypesData).reduce((a, b) => a + b, 0);
                    
                    // è¨ˆç®—ç™¾åˆ†æ¯”
                    const nightShiftPercent = totalFlights > 0 ? ((shiftTypesData['å¤œç­'] / totalFlights) * 100).toFixed(1) : '0.0';
                    const morningShiftPercent = totalFlights > 0 ? ((shiftTypesData['æ—©ç­'] / totalFlights) * 100).toFixed(1) : '0.0';
                    const eveningShiftPercent = totalFlights > 0 ? ((shiftTypesData['æ™šç­'] / totalFlights) * 100).toFixed(1) : '0.0';
                    const dayShiftPercent = totalFlights > 0 ? ((shiftTypesData['æ—¥ç­'] / totalFlights) * 100).toFixed(1) : '0.0';
                    
                    // è©•ä¼°å¤œç­æ¯”ä¾‹
                    const nightShiftAssessment = parseFloat(nightShiftPercent) > 20 ? 'é«˜æ–¼å»ºè­°ä¸Šé™ï¼ˆ20%ï¼‰ï¼Œéœ€å„ªå…ˆèª¿æ•´' :
                                                parseFloat(nightShiftPercent) > 15 ? 'æ¥è¿‘å»ºè­°ä¸Šé™ï¼Œéœ€å¯†åˆ‡ç›£æ§' :
                                                'åœ¨åˆç†ç¯„åœå…§';
                    const nightShiftClass = parseFloat(nightShiftPercent) > 20 ? 'stat-high' :
                                           parseFloat(nightShiftPercent) > 15 ? 'stat-medium' : 'stat-low';
                    
                    result.interpretation = result.interpretation
                        .replace('{{nightShiftPercent}}', nightShiftPercent)
                        .replace('{{nightShiftAssessment}}', nightShiftAssessment)
                        .replace('{{nightShiftClass}}', nightShiftClass)
                        .replace('{{morningShiftPercent}}', morningShiftPercent)
                        .replace('{{eveningShiftPercent}}', eveningShiftPercent)
                        .replace('{{dayShiftPercent}}', dayShiftPercent)
                        .replace('{{commonShiftCombo}}', 'æ—©ç­æ¥æ™šç­');
                    break;
            }
            
            return result;
        }
        
        // æ›´æ–°åœ–è¡¨æ•¸æ“šç¶²æ ¼
        function updateChartDataGrid(chartId) {
            const dataGrid = document.getElementById('chart-data-grid');
            let html = '';
            
            switch(chartId) {
                case 'friDistributionChart':
                    const dist = analysisResults.friDistribution;
                    const total = dist.total;
                    
                    html = `
                        <div class="chart-detail-card">
                            <div class="chart-detail-card-title">ä½é¢¨éšªäººå“¡</div>
                            <div class="chart-detail-card-value">${dist.low}äºº</div>
                            <div style="font-size:0.8rem;color:#666;">ä½”${((dist.low/total)*100).toFixed(1)}%</div>
                        </div>
                        <div class="chart-detail-card">
                            <div class="chart-detail-card-title">ä¸­é¢¨éšªäººå“¡</div>
                            <div class="chart-detail-card-value">${dist.medium}äºº</div>
                            <div style="font-size:0.8rem;color:#666;">ä½”${((dist.medium/total)*100).toFixed(1)}%</div>
                        </div>
                        <div class="chart-detail-card">
                            <div class="chart-detail-card-title">é«˜é¢¨éšªäººå“¡</div>
                            <div class="chart-detail-card-value">${dist.high}äºº</div>
                            <div style="font-size:0.8rem;color:#666;">ä½”${((dist.high/total)*100).toFixed(1)}%</div>
                        </div>
                        <div class="chart-detail-card">
                            <div class="chart-detail-card-title">ç¸½äººæ•¸</div>
                            <div class="chart-detail-card-value">${total}äºº</div>
                            <div style="font-size:0.8rem;color:#666;">åˆ†ææ¨£æœ¬</div>
                        </div>
                    `;
                    break;
                    
                case 'consecutiveDaysChart':
                    const compliance = analysisResults.consecutiveDays.compliance;
                    
                    html = `
                        <div class="chart-detail-card">
                            <div class="chart-detail-card-title">æ³•è¦ç¬¦åˆç‡</div>
                            <div class="chart-detail-card-value">${compliance.complianceRate}%</div>
                            <div style="font-size:0.8rem;color:#666;">ç¬¦åˆå‹åŸºæ³•ç¬¬36æ¢</div>
                        </div>
                        <div class="chart-detail-card">
                            <div class="chart-detail-card-title">é•è¦äººæ•¸</div>
                            <div class="chart-detail-card-value">${compliance.nonCompliant}äºº</div>
                            <div style="font-size:0.8rem;color:#666;">é€£çºŒå·¥ä½œ>6å¤©</div>
                        </div>
                        <div class="chart-detail-card">
                            <div class="chart-detail-card-title">å¹³å‡é€£çºŒå¤©æ•¸</div>
                            <div class="chart-detail-card-value">${analysisResults.descriptiveStats.consecutiveDays.mean}</div>
                            <div style="font-size:0.8rem;color:#666;">å¤©</div>
                        </div>
                        <div class="chart-detail-card">
                            <div class="chart-detail-card-title">æœ€é•·é€£çºŒå¤©æ•¸</div>
                            <div class="chart-detail-card-value">${analysisResults.descriptiveStats.consecutiveDays.max}</div>
                            <div style="font-size:0.8rem;color:#666;">å¤©</div>
                        </div>
                    `;
                    break;
                    
                default:
                    // å…¶ä»–åœ–è¡¨ä½¿ç”¨é€šç”¨æ•¸æ“š
                    const totalPeople = Object.keys(analysisResults.people).length;
                    const avgFriScore = analysisResults.descriptiveStats.workDays ? 
                        analysisResults.workloadData.reduce((sum, p) => sum + p.friScore, 0) / analysisResults.workloadData.length : 0;
                    
                    html = `
                        <div class="chart-detail-card">
                            <div class="chart-detail-card-title">åˆ†æäººå“¡æ•¸</div>
                            <div class="chart-detail-card-value">${totalPeople}äºº</div>
                            <div style="font-size:0.8rem;color:#666;">æœ‰æ•ˆæ¨£æœ¬</div>
                        </div>
                        <div class="chart-detail-card">
                            <div class="chart-detail-card-title">å¹³å‡FRIåˆ†æ•¸</div>
                            <div class="chart-detail-card-value">${avgFriScore.toFixed(1)}</div>
                            <div style="font-size:0.8rem;color:#666;">æ•´é«”ç–²å‹é¢¨éšª</div>
                        </div>
                        <div class="chart-detail-card">
                            <div class="chart-detail-card-title">è³‡æ–™æœŸé–“</div>
                            <div class="chart-detail-card-value">${inferredYear}å¹´</div>
                            <div style="font-size:0.8rem;color:#666;">åˆ†æå¹´åº¦</div>
                        </div>
                        <div class="chart-detail-card">
                            <div class="chart-detail-card-title">ç¸½èˆªç­æ•¸</div>
                            <div class="chart-detail-card-value">${rawData.length}</div>
                            <div style="font-size:0.8rem;color:#666;">å·¥ä½œè¨˜éŒ„</div>
                        </div>
                    `;
            }
            
            dataGrid.innerHTML = html;
        }
        
        // è™•ç†æª”æ¡ˆé¸æ“‡ï¼ˆè‡ªå‹•é–‹å§‹åˆ†æï¼‰
        function handleFileSelect() {
            if (!fileInput.files.length) return;
            
            const file = fileInput.files[0];
            
            if (!file.name.toLowerCase().endsWith('.csv')) {
                alert('è«‹é¸æ“‡CSVæ ¼å¼çš„æª”æ¡ˆ');
                return;
            }
            
            // é¡¯ç¤ºè¼‰å…¥æŒ‡ç¤ºå™¨
            loadingIndicator.classList.remove('hidden');
            dropArea.style.display = 'none';
            
            const reader = new FileReader();
            
            reader.onload = function(e) {
                const csvContent = e.target.result;
                parseCSVData(csvContent, file.name);
            };
            
            reader.onerror = function() {
                alert('è®€å–æª”æ¡ˆæ™‚ç™¼ç”ŸéŒ¯èª¤ï¼Œè«‹æª¢æŸ¥æª”æ¡ˆæ ¼å¼æ˜¯å¦æ­£ç¢º');
                loadingIndicator.classList.add('hidden');
                dropArea.style.display = 'block';
            };
            
            reader.readAsText(file, 'UTF-8');
        }
        
        // è§£æCSVæ•¸æ“šï¼ˆè‡ªå‹•é–‹å§‹åˆ†æï¼‰
        function parseCSVData(csvContent, fileName) {
            updateProgress(10, 'è§£æCSVè³‡æ–™...');
            
            Papa.parse(csvContent, {
                header: true,
                skipEmptyLines: true,
                complete: function(results) {
                    if (results.errors && results.errors.length > 0) {
                        console.warn('CSVè§£æè­¦å‘Šï¼š', results.errors);
                    }
                    
                    // éæ¿¾ç„¡æ•ˆè¨˜éŒ„
                    rawData = results.data.filter(row => {
                        return row.äººå“¡ && isValidPersonName(row.äººå“¡) && 
                               row.æ—¥æœŸ && row.æ—¥æœŸ.trim() !== '';
                    });
                    
                    // æ¨æ–·å¹´ä»½
                    inferredYear = inferYearFromData(rawData);
                    
                    updateProgress(30, `æˆåŠŸè§£æ ${rawData.length} ç­†æœ‰æ•ˆè³‡æ–™`);
                    
                    // é¡¯ç¤ºè³‡æ–™é è¦½
                    displayDataPreview(rawData);
                    dataPreviewContainer.classList.remove('hidden');
                    
                    // è‡ªå‹•é–‹å§‹åˆ†æ
                    setTimeout(() => {
                        startAnalysis();
                    }, 500);
                },
                error: function(error) {
                    alert('è§£æCSVæª”æ¡ˆæ™‚ç™¼ç”ŸéŒ¯èª¤ï¼š' + error.message);
                    updateProgress(0, 'è§£æå¤±æ•—');
                    loadingIndicator.classList.add('hidden');
                    dropArea.style.display = 'block';
                }
            });
        }
        
        // é¡¯ç¤ºè³‡æ–™é è¦½
        function displayDataPreview(data) {
            if (!data || data.length === 0) {
                dataPreview.innerHTML = '<p style="padding: 20px; text-align: center;">æ²’æœ‰è³‡æ–™å¯é¡¯ç¤º</p>';
                return;
            }
            
            // åªé¡¯ç¤ºå‰10ç­†è³‡æ–™
            const previewData = data.slice(0, 10);
            const headers = Object.keys(previewData[0]);
            
            let tableHTML = '<table class="thesis-table">';
            tableHTML += '<thead><tr>';
            headers.forEach(header => {
                tableHTML += `<th>${header}</th>`;
            });
            tableHTML += '</tr></thead>';
            
            tableHTML += '<tbody>';
            previewData.forEach((row, index) => {
                tableHTML += '<tr>';
                headers.forEach(header => {
                    tableHTML += `<td>${row[header] || ''}</td>`;
                });
                tableHTML += '</tr>';
            });
            tableHTML += '</tbody></table>';
            
            if (data.length > 10) {
                tableHTML += `<p style="text-align: center; padding: 10px; color: #666;">... é‚„æœ‰ ${data.length - 10} ç­†è³‡æ–™æœªé¡¯ç¤º</p>`;
            }
            
            dataPreview.innerHTML = tableHTML;
        }
        
        // æ¸…é™¤è³‡æ–™
        function clearData() {
            if (confirm('ç¢ºå®šè¦æ¸…é™¤æ‰€æœ‰è³‡æ–™å—ï¼Ÿæ‰€æœ‰ç•¶å‰è³‡æ–™å°‡æœƒè¢«æ¸…é™¤ã€‚')) {
                rawData = [];
                dataPreviewContainer.classList.add('hidden');
                analysisResultsSection.classList.add('hidden');
                fileInput.value = '';
                loadingIndicator.classList.add('hidden');
                dropArea.style.display = 'block';
                
                // æ¸…é™¤åœ–è¡¨
                Object.values(charts).forEach(chart => {
                    if (chart) chart.destroy();
                });
                charts = {};
                
                alert('è³‡æ–™å·²æ¸…é™¤');
            }
        }
        
        // é–‹å§‹åˆ†æï¼ˆè‡ªå‹•åŸ·è¡Œï¼‰
        function startAnalysis() {
            // æ¨¡æ“¬åˆ†æéç¨‹
            simulateAnalysisProgress();
        }
        
        // æ¨¡æ“¬åˆ†æé€²åº¦
        function simulateAnalysisProgress() {
            let progress = 0;
            const interval = setInterval(() => {
                progress += 5;
                
                if (progress <= 20) {
                    updateProgress(progress, 'åŸ·è¡Œæè¿°æ€§çµ±è¨ˆåˆ†æ...');
                } else if (progress <= 40) {
                    updateProgress(progress, 'è¨ˆç®—ç–²å‹é¢¨éšªæŒ‡æ•¸...');
                } else if (progress <= 60) {
                    updateProgress(progress, 'åˆ†æé€£çºŒå·¥ä½œå¤©æ•¸...');
                } else if (progress <= 80) {
                    updateProgress(progress, 'è¨ˆç®—ç›¸é—œæ€§ä¿‚æ•¸...');
                } else if (progress < 100) {
                    updateProgress(progress, 'ç”¢ç”Ÿåœ–è¡¨èˆ‡å ±å‘Š...');
                } else {
                    updateProgress(100, 'åˆ†æå®Œæˆï¼');
                    clearInterval(interval);
                    
                    // åŸ·è¡Œå¯¦éš›åˆ†æ
                    setTimeout(() => {
                        performAnalysis();
                        loadingIndicator.classList.add('hidden');
                        analysisResultsSection.classList.remove('hidden');
                        
                        // æ»¾å‹•åˆ°åˆ†æçµæœ
                        analysisResultsSection.scrollIntoView({ behavior: 'smooth' });
                    }, 500);
                }
            }, 100);
        }
        
        // æ›´æ–°é€²åº¦æ¢
        function updateProgress(percent, message) {
            progressBar.style.width = percent + '%';
            progressText.textContent = message;
        }
        
        // åŸ·è¡Œå®Œæ•´åˆ†æ
        function performAnalysis() {
            try {
                console.log("é–‹å§‹åŸ·è¡Œé‡åŒ–åˆ†æ...");
                
                // æ”¶é›†æ‰€æœ‰äººå“¡
                const people = [...new Set(rawData.map(r => r.äººå“¡))];
                
                // åˆå§‹åŒ–åˆ†æçµæœ
                analysisResults = {
                    people: {},
                    descriptiveStats: {},
                    friDistribution: { low: 0, medium: 0, high: 0 },
                    consecutiveDays: {},
                    workloadData: [],
                    correlationMatrix: {}
                };
                
                // ç‚ºæ¯äººè¨ˆç®—æŒ‡æ¨™
                people.forEach(person => {
                    const personRecords = rawData.filter(r => r.äººå“¡ === person);
                    analysisResults.people[person] = analyzePerson(person, personRecords);
                });
                
                // è¨ˆç®—æè¿°æ€§çµ±è¨ˆ
                calculateDescriptiveStats();
                
                // è¨ˆç®—FRIåˆ†æ•¸
                calculateFRIScores();
                
                // è¨ˆç®—FRIåˆ†ä½ˆ
                calculateFRIDistribution();
                
                // è¨ˆç®—é€£çºŒå·¥ä½œå¤©æ•¸åˆ†ä½ˆ
                calculateConsecutiveDaysDistribution();
                
                // è¨ˆç®—å·¥ä½œè² è·æ•¸æ“š
                calculateWorkloadData();
                
                // è¨ˆç®—ç›¸é—œæ€§çŸ©é™£
                calculateCorrelationMatrix();
                
                console.log("é‡åŒ–åˆ†æå®Œæˆï¼Œæº–å‚™é¡¯ç¤ºçµæœ...");
                
                // é¡¯ç¤ºåˆ†æçµæœ
                displayAnalysisResults();
                
                // ç¶å®šè¡¨æ ¼é»æ“Šäº‹ä»¶
                bindTableClickEvents();
            } catch (error) {
                console.error("åˆ†æéç¨‹ä¸­ç™¼ç”ŸéŒ¯èª¤:", error);
                alert("åˆ†æéç¨‹ä¸­ç™¼ç”ŸéŒ¯èª¤ï¼Œè«‹æª¢æŸ¥è³‡æ–™æ ¼å¼æ˜¯å¦æ­£ç¢ºã€‚");
                loadingIndicator.classList.add('hidden');
                dropArea.style.display = 'block';
            }
        }
        
        // åˆ†æå–®ä¸€äººå“¡
        function analyzePerson(personName, records) {
            // æå–å·¥ä½œæ—¥æœŸ
            const workDates = [...new Set(records.map(r => r.æ—¥æœŸ))];
            
            // è§£ææ—¥æœŸç‚ºæ¨™æº–æ ¼å¼
            const dateObjects = workDates
                .map(dateStr => parseChineseDateToStandard(dateStr))
                .filter(date => date)
                .sort((a, b) => a - b);
            
            // è¨ˆç®—é€£çºŒå·¥ä½œå¤©æ•¸
            const maxConsecutiveDays = calculateConsecutiveWorkDays(dateObjects);
            
            // è¨ˆç®—ç­å‹åˆ†ä½ˆ
            const shiftTypes = {};
            records.forEach(record => {
                const shiftType = getShiftType(record);
                shiftTypes[shiftType] = (shiftTypes[shiftType] || 0) + 1;
            });
            
            // è¨ˆç®—å¤œç­é »ç‡
            const nightShifts = shiftTypes['å¤œç­'] || 0;
            const nightShiftRatio = workDates.length > 0 ? (nightShifts / workDates.length) : 0;
            
            return {
                name: personName,
                totalWorkDays: workDates.length,
                totalFlights: records.length,
                avgFlightsPerDay: records.length / Math.max(1, workDates.length),
                maxConsecutiveDays: maxConsecutiveDays,
                nightShifts: nightShifts,
                nightShiftRatio: nightShiftRatio,
                shiftTypes: shiftTypes,
                workDates: workDates,
                rawRecords: records
            };
        }
        
        // è¨ˆç®—é€£çºŒå·¥ä½œå¤©æ•¸
        function calculateConsecutiveWorkDays(dateObjects) {
            if (dateObjects.length === 0) return 0;
            
            let maxConsecutive = 1;
            let currentConsecutive = 1;
            
            for (let i = 1; i < dateObjects.length; i++) {
                const prevDate = dateObjects[i-1];
                const currDate = dateObjects[i];
                
                // è¨ˆç®—å¤©æ•¸å·®
                const timeDiff = currDate.getTime() - prevDate.getTime();
                const dayDiff = Math.floor(timeDiff / (1000 * 3600 * 24));
                
                if (dayDiff === 1) {
                    currentConsecutive++;
                    maxConsecutive = Math.max(maxConsecutive, currentConsecutive);
                } else {
                    currentConsecutive = 1;
                }
            }
            
            return maxConsecutive;
        }
        
        // è¨ˆç®—æè¿°æ€§çµ±è¨ˆ
        function calculateDescriptiveStats() {
            const people = Object.values(analysisResults.people);
            
            // æ”¶é›†å„è®Šæ•¸çš„æ•¸å€¼
            const workDays = people.map(p => p.totalWorkDays);
            const totalFlights = people.map(p => p.totalFlights);
            const avgFlights = people.map(p => p.avgFlightsPerDay);
            const consecutiveDays = people.map(p => p.maxConsecutiveDays);
            const nightShifts = people.map(p => p.nightShifts);
            
            // è¨ˆç®—çµ±è¨ˆé‡
            analysisResults.descriptiveStats = {
                workDays: calculateStats(workDays),
                totalFlights: calculateStats(totalFlights),
                avgFlights: calculateStats(avgFlights),
                consecutiveDays: calculateStats(consecutiveDays),
                nightShifts: calculateStats(nightShifts)
            };
        }
        
        // è¨ˆç®—çµ±è¨ˆé‡ï¼ˆå¹³å‡æ•¸ã€ä¸­ä½æ•¸ã€çœ¾æ•¸ã€æ¨™æº–å·®ç­‰ï¼‰
        function calculateStats(data) {
            if (data.length === 0) return {};
            
            // æ’åº
            const sorted = [...data].sort((a, b) => a - b);
            
            // å¹³å‡æ•¸
            const mean = sorted.reduce((a, b) => a + b, 0) / sorted.length;
            
            // ä¸­ä½æ•¸
            const median = sorted.length % 2 === 0 
                ? (sorted[sorted.length/2 - 1] + sorted[sorted.length/2]) / 2
                : sorted[Math.floor(sorted.length/2)];
            
            // çœ¾æ•¸
            const frequency = {};
            let maxFreq = 0;
            let modes = [];
            
            sorted.forEach(value => {
                frequency[value] = (frequency[value] || 0) + 1;
                if (frequency[value] > maxFreq) {
                    maxFreq = frequency[value];
                    modes = [value];
                } else if (frequency[value] === maxFreq) {
                    modes.push(value);
                }
            });
            
            const mode = modes[0]; // å–ç¬¬ä¸€å€‹çœ¾æ•¸
            
            // æ¨™æº–å·®
            const variance = sorted.reduce((sum, val) => sum + Math.pow(val - mean, 2), 0) / (sorted.length - 1);
            const stdDev = Math.sqrt(variance);
            
            // ç¯„åœ
            const range = sorted[sorted.length - 1] - sorted[0];
            
            return {
                n: sorted.length,
                mean: parseFloat(mean.toFixed(2)),
                median: parseFloat(median.toFixed(2)),
                mode: parseFloat(mode.toFixed(2)),
                stdDev: parseFloat(stdDev.toFixed(2)),
                variance: parseFloat(variance.toFixed(2)),
                range: parseFloat(range.toFixed(2)),
                min: sorted[0],
                max: sorted[sorted.length - 1]
            };
        }
        
        // è¨ˆç®—FRIåˆ†æ•¸
        function calculateFRIScores() {
            const people = Object.keys(analysisResults.people);
            
            people.forEach(personName => {
                const person = analysisResults.people[personName];
                
                // FRIè¨ˆç®—å…¬å¼
                let fri = 0;
                
                // 1. åŸºæ–¼é€£çºŒå·¥ä½œå¤©æ•¸ (æ¬Šé‡ 0.35)
                const consecutiveScore = Math.min(person.maxConsecutiveDays / 7 * 35, 35);
                fri += consecutiveScore;
                
                // 2. åŸºæ–¼èˆªç­å¯†åº¦ (æ¬Šé‡ 0.30)
                const densityScore = Math.min(person.avgFlightsPerDay / 5 * 30, 30);
                fri += densityScore;
                
                // 3. åŸºæ–¼å¤œç­æ¯”ä¾‹ (æ¬Šé‡ 0.35)
                const nightShiftScore = Math.min(person.nightShiftRatio * 35, 35);
                fri += nightShiftScore;
                
                person.friScore = Math.min(Math.round(fri), 100);
                
                // åˆ¤æ–·é¢¨éšªç­‰ç´š
                if (person.friScore >= 70) {
                    person.riskLevel = 'é«˜é¢¨éšª';
                    person.riskClass = 'high';
                } else if (person.friScore >= 50) {
                    person.riskLevel = 'ä¸­é¢¨éšª';
                    person.riskClass = 'medium';
                } else {
                    person.riskLevel = 'ä½é¢¨éšª';
                    person.riskClass = 'low';
                }
            });
        }
        
        // è¨ˆç®—FRIåˆ†ä½ˆ
        function calculateFRIDistribution() {
            const people = Object.values(analysisResults.people);
            
            analysisResults.friDistribution = {
                low: people.filter(p => p.friScore < 50).length,
                medium: people.filter(p => p.friScore >= 50 && p.friScore < 70).length,
                high: people.filter(p => p.friScore >= 70).length,
                total: people.length
            };
        }
        
        // è¨ˆç®—é€£çºŒå·¥ä½œå¤©æ•¸åˆ†ä½ˆ
        function calculateConsecutiveDaysDistribution() {
            const people = Object.values(analysisResults.people);
            const consecutiveDays = people.map(p => p.maxConsecutiveDays);
            
            // è¨ˆç®—å„é€£çºŒå¤©æ•¸çš„é »ç‡
            const distribution = {};
            consecutiveDays.forEach(days => {
                distribution[days] = (distribution[days] || 0) + 1;
            });
            
            analysisResults.consecutiveDays.distribution = distribution;
            analysisResults.consecutiveDays.total = people.length;
            
            // è¨ˆç®—æ³•è¦ç¬¦åˆæ€§
            const compliant = people.filter(p => p.maxConsecutiveDays <= 6).length;
            const nonCompliant = people.filter(p => p.maxConsecutiveDays > 6).length;
            
            analysisResults.consecutiveDays.compliance = {
                compliant: compliant,
                nonCompliant: nonCompliant,
                complianceRate: (compliant / people.length * 100).toFixed(1)
            };
        }
        
        // è¨ˆç®—å·¥ä½œè² è·æ•¸æ“š
        function calculateWorkloadData() {
            const people = Object.values(analysisResults.people);
            
            analysisResults.workloadData = people.map(person => ({
                name: person.name,
                workDays: person.totalWorkDays,
                totalFlights: person.totalFlights,
                avgFlights: person.avgFlightsPerDay.toFixed(2),
                maxDailyFlights: calculateMaxDailyFlights(person.name),
                nightShifts: person.nightShifts,
                friScore: person.friScore,
                riskLevel: person.riskLevel
            }));
            
            // æŒ‰FRIåˆ†æ•¸æ’åº
            analysisResults.workloadData.sort((a, b) => b.friScore - a.friScore);
        }
        
        // è¨ˆç®—å–®æ—¥æœ€é«˜èˆªç­æ•¸
        function calculateMaxDailyFlights(personName) {
            const personRecords = rawData.filter(r => r.äººå“¡ === personName);
            const dailyFlights = {};
            
            personRecords.forEach(record => {
                const date = record.æ—¥æœŸ;
                dailyFlights[date] = (dailyFlights[date] || 0) + 1;
            });
            
            return Math.max(...Object.values(dailyFlights));
        }
        
        // è¨ˆç®—ç›¸é—œæ€§çŸ©é™£
        function calculateCorrelationMatrix() {
            const people = Object.values(analysisResults.people);
            
            // æ”¶é›†è®Šæ•¸
            const workDays = people.map(p => p.totalWorkDays);
            const avgFlights = people.map(p => p.avgFlightsPerDay);
            const consecutiveDays = people.map(p => p.maxConsecutiveDays);
            const nightShiftRatios = people.map(p => p.nightShiftRatio);
            const friScores = people.map(p => p.friScore);
            
            // è¨ˆç®—ç›¸é—œä¿‚æ•¸
            analysisResults.correlationMatrix = {
                workDays_avgFlights: calculatePearsonCorrelation(workDays, avgFlights),
                workDays_consecutiveDays: calculatePearsonCorrelation(workDays, consecutiveDays),
                workDays_nightShiftRatio: calculatePearsonCorrelation(workDays, nightShiftRatios),
                workDays_friScore: calculatePearsonCorrelation(workDays, friScores),
                avgFlights_consecutiveDays: calculatePearsonCorrelation(avgFlights, consecutiveDays),
                avgFlights_nightShiftRatio: calculatePearsonCorrelation(avgFlights, nightShiftRatios),
                avgFlights_friScore: calculatePearsonCorrelation(avgFlights, friScores),
                consecutiveDays_nightShiftRatio: calculatePearsonCorrelation(consecutiveDays, nightShiftRatios),
                consecutiveDays_friScore: calculatePearsonCorrelation(consecutiveDays, friScores),
                nightShiftRatio_friScore: calculatePearsonCorrelation(nightShiftRatios, friScores)
            };
        }
        
        // è¨ˆç®—Pearsonç›¸é—œä¿‚æ•¸
        function calculatePearsonCorrelation(x, y) {
            if (x.length !== y.length || x.length === 0) return 0;
            
            const n = x.length;
            const sumX = x.reduce((a, b) => a + b, 0);
            const sumY = y.reduce((a, b) => a + b, 0);
            const sumXY = x.reduce((sum, xi, i) => sum + xi * y[i], 0);
            const sumX2 = x.reduce((sum, xi) => sum + xi * xi, 0);
            const sumY2 = y.reduce((sum, yi) => sum + yi * yi, 0);
            
            const numerator = n * sumXY - sumX * sumY;
            const denominator = Math.sqrt((n * sumX2 - sumX * sumX) * (n * sumY2 - sumY * sumY));
            
            return denominator === 0 ? 0 : parseFloat((numerator / denominator).toFixed(3));
        }
        
        // é¡¯ç¤ºåˆ†æçµæœ
        function displayAnalysisResults() {
            // é¡¯ç¤ºæ¡ˆä¾‹è™•ç†æ‘˜è¦
            displayCaseSummary();
            
            // é¡¯ç¤ºæè¿°æ€§çµ±è¨ˆé‡
            displayDescriptiveStats();
            
            // é¡¯ç¤ºFRIåˆ†æ
            displayFRIAnalysis();
            
            // é¡¯ç¤ºé€£çºŒå·¥ä½œå¤©æ•¸åˆ†æ
            displayConsecutiveDaysAnalysis();
            
            // é¡¯ç¤ºå·¥ä½œè² è·åˆ†æ
            displayWorkloadAnalysis();
            
            // é¡¯ç¤ºç›¸é—œæ€§åˆ†æ
            displayCorrelationAnalysis();
            
            // å»ºç«‹åœ–è¡¨
            createCharts();
            
            // é¡¯ç¤ºç ”ç©¶çµè«–èˆ‡å»ºè­°
            displayResearchConclusions();
        }
        
        // é¡¯ç¤ºæ¡ˆä¾‹è™•ç†æ‘˜è¦
        function displayCaseSummary() {
            const totalCases = rawData.length;
            const validCases = rawData.length;
            const excludedCases = 0;
            const totalPeople = Object.keys(analysisResults.people).length;
            
            const body = document.getElementById('case-summary-body');
            body.innerHTML = `
                <tr>
                    <td>æœ‰æ•ˆæ’ç­è¨˜éŒ„æ•¸</td>
                    <td>${validCases}</td>
                    <td>${excludedCases}</td>
                    <td>${totalCases}</td>
                    <td>${((validCases / totalCases) * 100).toFixed(1)}%</td>
                </tr>
                <tr>
                    <td>åˆ†æäººå“¡æ•¸ï¼ˆå»è­˜åˆ¥åŒ–ï¼‰</td>
                    <td>${totalPeople}</td>
                    <td>0</td>
                    <td>${totalPeople}</td>
                    <td>100.0%</td>
                </tr>
                <tr>
                    <td>è³‡æ–™å¹´ä»½</td>
                    <td colspan="3">${inferredYear}å¹´</td>
                    <td>${isLeapYear(inferredYear) ? 'é–å¹´' : 'å¹³å¹´'}</td>
                </tr>
            `;
        }
        
        // é¡¯ç¤ºæè¿°æ€§çµ±è¨ˆé‡
        function displayDescriptiveStats() {
            const stats = analysisResults.descriptiveStats;
            const body = document.getElementById('descriptive-stats-body');
            
            body.innerHTML = `
                <tr>
                    <td>å·¥ä½œå¤©æ•¸</td>
                    <td>${stats.workDays.mean}</td>
                    <td>${stats.workDays.median}</td>
                    <td>${stats.workDays.mode}</td>
                    <td>${stats.workDays.stdDev}</td>
                    <td>${stats.workDays.variance}</td>
                    <td>${stats.workDays.range}</td>
                    <td>${stats.workDays.min}</td>
                    <td>${stats.workDays.max}</td>
                </tr>
                <tr>
                    <td>ç¸½èˆªç­æ•¸</td>
                    <td>${stats.totalFlights.mean}</td>
                    <td>${stats.totalFlights.median}</td>
                    <td>${stats.totalFlights.mode}</td>
                    <td>${stats.totalFlights.stdDev}</td>
                    <td>${stats.totalFlights.variance}</td>
                    <td>${stats.totalFlights.range}</td>
                    <td>${stats.totalFlights.min}</td>
                    <td>${stats.totalFlights.max}</td>
                </tr>
                <tr>
                    <td>å¹³å‡æ¯æ—¥èˆªç­</td>
                    <td>${stats.avgFlights.mean}</td>
                    <td>${stats.avgFlights.median}</td>
                    <td>${stats.avgFlights.mode}</td>
                    <td>${stats.avgFlights.stdDev}</td>
                    <td>${stats.avgFlights.variance}</td>
                    <td>${stats.avgFlights.range}</td>
                    <td>${stats.avgFlights.min}</td>
                    <td>${stats.avgFlights.max}</td>
                </tr>
                <tr>
                    <td>æœ€å¤§é€£çºŒå·¥ä½œå¤©æ•¸</td>
                    <td>${stats.consecutiveDays.mean}</td>
                    <td>${stats.consecutiveDays.median}</td>
                    <td>${stats.consecutiveDays.mode}</td>
                    <td>${stats.consecutiveDays.stdDev}</td>
                    <td>${stats.consecutiveDays.variance}</td>
                    <td>${stats.consecutiveDays.range}</td>
                    <td>${stats.consecutiveDays.min}</td>
                    <td>${stats.consecutiveDays.max}</td>
                </tr>
                <tr>
                    <td>å¤œç­æ¬¡æ•¸</td>
                    <td>${stats.nightShifts.mean}</td>
                    <td>${stats.nightShifts.median}</td>
                    <td>${stats.nightShifts.mode}</td>
                    <td>${stats.nightShifts.stdDev}</td>
                    <td>${stats.nightShifts.variance}</td>
                    <td>${stats.nightShifts.range}</td>
                    <td>${stats.nightShifts.min}</td>
                    <td>${stats.nightShifts.max}</td>
                </tr>
            `;
        }
        
        // é¡¯ç¤ºFRIåˆ†æ
        function displayFRIAnalysis() {
            const dist = analysisResults.friDistribution;
            const total = dist.total;
            
            const body = document.getElementById('fri-distribution-body');
            body.innerHTML = `
                <tr>
                    <td><span class="stat-label stat-low">ä½é¢¨éšª</span> (FRI < 50)</td>
                    <td>${dist.low}</td>
                    <td>${((dist.low / total) * 100).toFixed(1)}</td>
                    <td>${((dist.low / total) * 100).toFixed(1)}</td>
                    <td>${((dist.low / total) * 100).toFixed(1)}</td>
                    <td>æŒçºŒç›£æ§ï¼Œç¶­æŒè‰¯å¥½æ’ç­</td>
                </tr>
                <tr>
                    <td><span class="stat-label stat-medium">ä¸­é¢¨éšª</span> (50 â‰¤ FRI < 70)</td>
                    <td>${dist.medium}</td>
                    <td>${((dist.medium / total) * 100).toFixed(1)}</td>
                    <td>${((dist.medium / total) * 100).toFixed(1)}</td>
                    <td>${(((dist.low + dist.medium) / total) * 100).toFixed(1)}</td>
                    <td>é©åº¦èª¿æ•´æ’ç­ï¼Œå®‰æ’ä¼‘æ¯</td>
                </tr>
                <tr>
                    <td><span class="stat-label stat-high">é«˜é¢¨éšª</span> (FRI â‰¥ 70)</td>
                    <td>${dist.high}</td>
                    <td>${((dist.high / total) * 100).toFixed(1)}</td>
                    <td>${((dist.high / total) * 100).toFixed(1)}</td>
                    <td>100.0</td>
                    <td>ç«‹å³èª¿æ•´æ’ç­ï¼Œå®‰æ’å°ˆå®¶è¨ªè«‡</td>
                </tr>
                <tr>
                    <td><strong>ç¸½è¨ˆ</strong></td>
                    <td><strong>${total}</strong></td>
                    <td><strong>100.0</strong></td>
                    <td><strong>100.0</strong></td>
                    <td><strong>100.0</strong></td>
                    <td><strong>${dist.high > 0 ? 'éœ€å„ªå…ˆè™•ç†é«˜é¢¨éšªäººå“¡' : 'æ•´é«”é¢¨éšªå¯æ§'}</strong></td>
                </tr>
            `;
        }
        
        // é¡¯ç¤ºé€£çºŒå·¥ä½œå¤©æ•¸åˆ†æ
        function displayConsecutiveDaysAnalysis() {
            const dist = analysisResults.consecutiveDays.distribution;
            const total = analysisResults.consecutiveDays.total;
            const compliance = analysisResults.consecutiveDays.compliance;
            
            // æ’åºé€£çºŒå¤©æ•¸
            const sortedDays = Object.keys(dist).map(Number).sort((a, b) => a - b);
            
            let bodyHTML = '';
            let cumulative = 0;
            
            sortedDays.forEach(days => {
                const freq = dist[days];
                const percent = (freq / total * 100).toFixed(1);
                cumulative += freq;
                const cumulativePercent = (cumulative / total * 100).toFixed(1);
                
                // åˆ¤æ–·æ³•è¦ç¬¦åˆæ€§
                const complianceText = days <= 6 ? 'ç¬¦åˆ' : 'ä¸ç¬¦åˆ';
                const complianceClass = days <= 6 ? 'stat-low' : 'stat-high';
                
                bodyHTML += `
                <tr>
                    <td>${days} å¤©</td>
                    <td>${freq}</td>
                    <td>${percent}</td>
                    <td>${percent}</td>
                    <td>${cumulativePercent}</td>
                    <td><span class="stat-label ${complianceClass}">${complianceText}</span></td>
                </tr>
                `;
            });
            
            // æ·»åŠ ç¸½è¨ˆè¡Œ
            bodyHTML += `
                <tr>
                    <td><strong>ç¸½è¨ˆ</strong></td>
                    <td><strong>${total}</strong></td>
                    <td><strong>100.0</strong></td>
                    <td><strong>100.0</strong></td>
                    <td><strong>100.0</strong></td>
                    <td><span class="stat-label ${compliance.complianceRate >= 80 ? 'stat-low' : 'stat-high'}">æ³•è¦ç¬¦åˆç‡: ${compliance.complianceRate}%</span></td>
                </tr>
            `;
            
            document.getElementById('consecutive-days-body').innerHTML = bodyHTML;
        }
        
        // é¡¯ç¤ºå·¥ä½œè² è·åˆ†æ
        function displayWorkloadAnalysis() {
            const workloadData = analysisResults.workloadData;
            let bodyHTML = '';
            
            workloadData.forEach(person => {
                let riskClass = '';
                if (person.riskLevel === 'é«˜é¢¨éšª') riskClass = 'stat-high';
                else if (person.riskLevel === 'ä¸­é¢¨éšª') riskClass = 'stat-medium';
                else riskClass = 'stat-low';
                
                bodyHTML += `
                <tr data-person="${person.name}">
                    <td><strong>${person.name}</strong></td>
                    <td>${person.workDays}</td>
                    <td>${person.totalFlights}</td>
                    <td>${person.avgFlights}</td>
                    <td>${person.maxDailyFlights}</td>
                    <td>${person.nightShifts}</td>
                    <td>${person.friScore}</td>
                    <td><span class="stat-label ${riskClass}">${person.riskLevel}</span></td>
                </tr>
                `;
            });
            
            document.getElementById('workload-table-body').innerHTML = bodyHTML;
        }
        
        // ç¶å®šè¡¨æ ¼é»æ“Šäº‹ä»¶
        function bindTableClickEvents() {
            const tableRows = document.querySelectorAll('#workload-table-body tr');
            
            tableRows.forEach(row => {
                row.addEventListener('click', function() {
                    const personName = this.getAttribute('data-person');
                    showPersonDetail(personName);
                });
            });
        }
        
        // é¡¯ç¤ºäººå“¡è©³ç´°è³‡æ–™
        function showPersonDetail(personName) {
            const person = analysisResults.people[personName];
            if (!person) return;
            
            // æ›´æ–°å½ˆå‡ºå±¤æ¨™é¡Œ
            document.getElementById('person-detail-name').innerHTML = `
                ${personName} <span class="stat-label ${person.riskClass === 'high' ? 'stat-high' : person.riskClass === 'medium' ? 'stat-medium' : 'stat-low'}">${person.riskLevel} (FRI: ${person.friScore})</span>
            `;
            
            // æ›´æ–°è©³ç´°æŒ‡æ¨™
            const metricsGrid = document.getElementById('person-detail-metrics');
            metricsGrid.innerHTML = `
                <div class="person-detail-card">
                    <div class="detail-card-title">å·¥ä½œå¤©æ•¸</div>
                    <div class="detail-card-value">${person.totalWorkDays}</div>
                </div>
                <div class="person-detail-card">
                    <div class="detail-card-title">ç¸½èˆªç­æ•¸</div>
                    <div class="detail-card-value">${person.totalFlights}</div>
                </div>
                <div class="person-detail-card">
                    <div class="detail-card-title">å¹³å‡æ¯æ—¥èˆªç­</div>
                    <div class="detail-card-value">${person.avgFlightsPerDay.toFixed(2)}</div>
                </div>
                <div class="person-detail-card">
                    <div class="detail-card-title">æœ€é•·é€£çºŒå·¥ä½œ</div>
                    <div class="detail-card-value ${person.maxConsecutiveDays > 5 ? 'stat-high' : person.maxConsecutiveDays > 3 ? 'stat-medium' : 'stat-low'}">${person.maxConsecutiveDays} å¤©</div>
                </div>
                <div class="person-detail-card">
                    <div class="detail-card-title">å¤œç­æ¬¡æ•¸</div>
                    <div class="detail-card-value ${person.nightShifts > 5 ? 'stat-high' : person.nightShifts > 2 ? 'stat-medium' : 'stat-low'}">${person.nightShifts}</div>
                </div>
                <div class="person-detail-card">
                    <div class="detail-card-title">å¤œç­æ¯”ä¾‹</div>
                    <div class="detail-card-value">${(person.nightShiftRatio * 100).toFixed(1)}%</div>
                </div>
            `;
            
            // æ›´æ–°å·¥ä½œæ—¥æœŸæ™‚é–“è»¸
            const workDatesContainer = document.getElementById('person-work-dates');
            workDatesContainer.innerHTML = '';
            
            person.workDates.forEach(date => {
                const dateElement = document.createElement('div');
                dateElement.className = 'timeline-item';
                dateElement.textContent = date;
                workDatesContainer.appendChild(dateElement);
            });
            
            // æ›´æ–°åŸå§‹è³‡æ–™
            const rawDataContainer = document.getElementById('person-raw-data');
            let rawDataHTML = '<table class="thesis-table" style="font-size: 0.8rem;">';
            rawDataHTML += '<thead><tr><th>æ—¥æœŸ</th><th>æ©Ÿè™Ÿ</th><th>èˆªç­</th><th>STA</th><th>STD</th><th>ä¾†è‡ª</th><th>é£›å¾€</th><th>ç­å‹</th></tr></thead><tbody>';
            
            person.rawRecords.forEach(record => {
                const shiftType = getShiftType(record);
                rawDataHTML += `
                    <tr>
                        <td>${record.æ—¥æœŸ}</td>
                        <td>${record.æ©Ÿè™Ÿ || ''}</td>
                        <td>${record.æª¢æŸ¥ || record.å…¥å¢ƒ || record.å‡ºå¢ƒ || ''}</td>
                        <td>${record.STA || ''}</td>
                        <td>${record.STD || ''}</td>
                        <td>${record.ä¾†è‡ª || ''}</td>
                        <td>${record.é£›å¾€ || ''}</td>
                        <td>${shiftType}</td>
                    </tr>
                `;
            });
            
            rawDataHTML += '</tbody></table>';
            rawDataContainer.innerHTML = rawDataHTML;
            
            // æ›´æ–°å°ˆå®¶è¨ªè«‡å»ºè­°
            let interviewReason = '';
            if (person.friScore >= 70) {
                interviewReason = `FRIåˆ†æ•¸é«˜é”${person.friScore}ï¼ˆé«˜é¢¨éšªï¼‰`;
            } else if (person.maxConsecutiveDays > 6) {
                interviewReason = `é€£çºŒå·¥ä½œ${person.maxConsecutiveDays}å¤©ï¼Œè¶…éæ³•è¦ä¸Šé™`;
            } else if (person.nightShifts > 5) {
                interviewReason = `å¤œç­æ¬¡æ•¸é«˜é”${person.nightShifts}æ¬¡ï¼Œç”Ÿç†ç¯€å¾‹å¹²æ“¾åš´é‡`;
            } else {
                interviewReason = 'å·¥ä½œè² è·è¼ƒé«˜ï¼Œå…·ä»£è¡¨æ€§';
            }
            
            document.getElementById('interview-reason').textContent = interviewReason;
            
            // é¡¯ç¤ºå½ˆå‡ºå±¤
            personDetailModal.style.display = 'block';
        }
        
        // é¡¯ç¤ºç›¸é—œæ€§åˆ†æ
        function displayCorrelationAnalysis() {
            const corr = analysisResults.correlationMatrix;
            
            const body = document.getElementById('correlation-table-body');
            body.innerHTML = `
                <tr>
                    <td>å·¥ä½œå¤©æ•¸</td>
                    <td>1.000</td>
                    <td>${formatCorrelation(corr.workDays_avgFlights)}</td>
                    <td>${formatCorrelation(corr.workDays_consecutiveDays)}</td>
                    <td>${formatCorrelation(corr.workDays_nightShiftRatio)}</td>
                    <td>${formatCorrelation(corr.workDays_friScore)}</td>
                </tr>
                <tr>
                    <td>å¹³å‡æ¯æ—¥èˆªç­</td>
                    <td>${formatCorrelation(corr.workDays_avgFlights)}</td>
                    <td>1.000</td>
                    <td>${formatCorrelation(corr.avgFlights_consecutiveDays)}</td>
                    <td>${formatCorrelation(corr.avgFlights_nightShiftRatio)}</td>
                    <td>${formatCorrelation(corr.avgFlights_friScore)}</td>
                </tr>
                <tr>
                    <td>æœ€å¤§é€£çºŒå·¥ä½œå¤©æ•¸</td>
                    <td>${formatCorrelation(corr.workDays_consecutiveDays)}</td>
                    <td>${formatCorrelation(corr.avgFlights_consecutiveDays)}</td>
                    <td>1.000</td>
                    <td>${formatCorrelation(corr.consecutiveDays_nightShiftRatio)}</td>
                    <td>${formatCorrelation(corr.consecutiveDays_friScore)}</td>
                </tr>
                <tr>
                    <td>å¤œç­æ¯”ä¾‹</td>
                    <td>${formatCorrelation(corr.workDays_nightShiftRatio)}</td>
                    <td>${formatCorrelation(corr.avgFlights_nightShiftRatio)}</td>
                    <td>${formatCorrelation(corr.consecutiveDays_nightShiftRatio)}</td>
                    <td>1.000</td>
                    <td>${formatCorrelation(corr.nightShiftRatio_friScore)}</td>
                </tr>
                <tr>
                    <td>FRIåˆ†æ•¸</td>
                    <td>${formatCorrelation(corr.workDays_friScore)}</td>
                    <td>${formatCorrelation(corr.avgFlights_friScore)}</td>
                    <td>${formatCorrelation(corr.consecutiveDays_friScore)}</td>
                    <td>${formatCorrelation(corr.nightShiftRatio_friScore)}</td>
                    <td>1.000</td>
                </tr>
            `;
        }
        
        // æ ¼å¼åŒ–ç›¸é—œä¿‚æ•¸é¡¯ç¤º
        function formatCorrelation(r) {
            if (r === 0) return '.000';
            
            const absR = Math.abs(r);
            let stars = '';
            
            if (absR >= 0.5) stars = '**';
            else if (absR >= 0.3) stars = '*';
            
            return r.toFixed(3) + stars;
        }
        
        // é¡¯ç¤ºç ”ç©¶çµè«–èˆ‡å»ºè­°
        function displayResearchConclusions() {
            const dist = analysisResults.friDistribution;
            const compliance = analysisResults.consecutiveDays.compliance;
            const totalPeople = Object.keys(analysisResults.people).length;
            
            const findings = document.getElementById('quantitative-findings');
            findings.innerHTML = `
                <p><strong>1. ç–²å‹é¢¨éšªæ¦‚æ³ï¼š</strong> åˆ†æ ${totalPeople} åäººå“¡ä¸­ï¼Œé«˜é¢¨éšªäººå“¡ä½” ${((dist.high/dist.total)*100).toFixed(1)}% (${dist.high}äºº)ï¼Œä¸­é¢¨éšªä½” ${((dist.medium/dist.total)*100).toFixed(1)}% (${dist.medium}äºº)ï¼Œä½é¢¨éšªä½” ${((dist.low/dist.total)*100).toFixed(1)}% (${dist.low}äºº)ã€‚</p>
                <p><strong>2. æ³•è¦ç¬¦åˆæ€§ï¼š</strong> é€£çºŒå·¥ä½œå¤©æ•¸æ³•è¦ç¬¦åˆç‡ç‚º ${compliance.complianceRate}%ï¼Œ${compliance.nonCompliant > 0 ? `æœ‰ ${compliance.nonCompliant} äººé€£çºŒå·¥ä½œè¶…é6å¤©` : 'æ‰€æœ‰äººå“¡çš†ç¬¦åˆæ³•è¦è¦æ±‚'}ã€‚</p>
                <p><strong>3. ç›¸é—œæ€§åˆ†æï¼š</strong> æœ€å¤§é€£çºŒå·¥ä½œå¤©æ•¸èˆ‡FRIåˆ†æ•¸å‘ˆç¾${Math.abs(analysisResults.correlationMatrix.consecutiveDays_friScore) >= 0.5 ? 'é«˜åº¦' : ''}æ­£ç›¸é—œ (r = ${analysisResults.correlationMatrix.consecutiveDays_friScore.toFixed(3)})ï¼Œé¡¯ç¤ºé€£çºŒå·¥ä½œå¤©æ•¸æ˜¯å½±éŸ¿ç–²å‹é¢¨éšªçš„é‡è¦å› ç´ ã€‚</p>
                <p><strong>4. å¤œç­å½±éŸ¿ï¼š</strong> å¤œç­æ¯”ä¾‹èˆ‡FRIåˆ†æ•¸ç›¸é—œæ€§ç‚º ${analysisResults.correlationMatrix.nightShiftRatio_friScore.toFixed(3)}ï¼Œ${analysisResults.correlationMatrix.nightShiftRatio_friScore >= 0.3 ? 'é¡¯ç¤ºå¤œç­ä½œæ¥­é¡¯è‘—å½±éŸ¿ç–²å‹é¢¨éšª' : 'å¤œç­å½±éŸ¿ç›¸å°æœ‰é™'}ã€‚</p>
            `;
        }
        
        // å»ºç«‹åœ–è¡¨
        function createCharts() {
            // æ¸…é™¤èˆŠåœ–è¡¨
            Object.values(charts).forEach(chart => {
                if (chart) chart.destroy();
            });
            charts = {};
            
            // 1. FRIåˆ†ä½ˆåœ–
            createFRIDistributionChart();
            
            // 2. FRIèˆ‡é€£çºŒå·¥ä½œå¤©æ•¸é—œè¯åœ–
            createFRIConsecutiveChart();
            
            // 3. é€£çºŒå·¥ä½œå¤©æ•¸åˆ†ä½ˆåœ–
            createConsecutiveDaysChart();
            
            // 4. å¤œç­é »ç‡èˆ‡ç–²å‹é¢¨éšªé—œè¯åœ–
            createNightShiftChart();
            
            // 5. å·¥ä½œè² è·æ™‚é–“åºåˆ—åœ–
            createWorkloadTrendChart();
            
            // 6. ç­å‹åˆ†ä½ˆåœ–
            createShiftTypeChart();
        }
        
        // å»ºç«‹FRIåˆ†ä½ˆåœ–
        function createFRIDistributionChart() {
            const ctx = document.getElementById('friDistributionChart').getContext('2d');
            const dist = analysisResults.friDistribution;
            
            charts.friDistributionChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ['ä½é¢¨éšª (FRI < 50)', 'ä¸­é¢¨éšª (50 â‰¤ FRI < 70)', 'é«˜é¢¨éšª (FRI â‰¥ 70)'],
                    datasets: [{
                        label: 'äººæ•¸',
                        data: [dist.low, dist.medium, dist.high],
                        backgroundColor: [
                            'rgba(40, 167, 69, 0.7)',
                            'rgba(255, 193, 7, 0.7)',
                            'rgba(220, 53, 69, 0.7)'
                        ],
                        borderColor: [
                            'rgb(40, 167, 69)',
                            'rgb(255, 193, 7)',
                            'rgb(220, 53, 69)'
                        ],
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'äººæ•¸'
                            }
                        },
                        x: {
                            title: {
                                display: true,
                                text: 'é¢¨éšªç­‰ç´š'
                            }
                        }
                    }
                }
            });
        }
        
        // å»ºç«‹FRIèˆ‡é€£çºŒå·¥ä½œå¤©æ•¸é—œè¯åœ–
        function createFRIConsecutiveChart() {
            const ctx = document.getElementById('friConsecutiveChart').getContext('2d');
            const people = Object.values(analysisResults.people);
            
            // æº–å‚™æ•¸æ“š
            const labels = people.map(p => p.name);
            const friScores = people.map(p => p.friScore);
            const consecutiveDays = people.map(p => p.maxConsecutiveDays);
            
            // æŒ‰FRIåˆ†æ•¸æ’åº
            const sortedIndices = friScores.map((score, index) => ({score, index}))
                .sort((a, b) => b.score - a.score)
                .map(item => item.index);
            
            const sortedLabels = sortedIndices.map(i => labels[i].substring(0, 3) + '...');
            const sortedFriScores = sortedIndices.map(i => friScores[i]);
            const sortedConsecutiveDays = sortedIndices.map(i => consecutiveDays[i]);
            
            charts.friConsecutiveChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: sortedLabels.slice(0, 15), // åªé¡¯ç¤ºå‰15äºº
                    datasets: [
                        {
                            label: 'FRIåˆ†æ•¸',
                            data: sortedFriScores.slice(0, 15),
                            borderColor: '#1a3c8b',
                            backgroundColor: 'rgba(26, 60, 139, 0.1)',
                            borderWidth: 3,
                            fill: false,
                            yAxisID: 'y'
                        },
                        {
                            label: 'é€£çºŒå·¥ä½œå¤©æ•¸',
                            data: sortedConsecutiveDays.slice(0, 15),
                            borderColor: '#dc3545',
                            backgroundColor: 'rgba(220, 53, 69, 0.1)',
                            borderWidth: 2,
                            fill: false,
                            yAxisID: 'y1'
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    plugins: {
                        legend: {
                            display: true,
                            position: 'top'
                        }
                    },
                    scales: {
                        y: {
                            type: 'linear',
                            display: true,
                            position: 'left',
                            title: {
                                display: true,
                                text: 'FRIåˆ†æ•¸'
                            },
                            min: 0,
                            max: 100
                        },
                        y1: {
                            type: 'linear',
                            display: true,
                            position: 'right',
                            title: {
                                display: true,
                                text: 'é€£çºŒå·¥ä½œå¤©æ•¸'
                            },
                            min: 0,
                            grid: {
                                drawOnChartArea: false
                            }
                        },
                        x: {
                            title: {
                                display: true,
                                text: 'äººå“¡ï¼ˆæŒ‰FRIæ’åºï¼‰'
                            }
                        }
                    }
                }
            });
        }
        
        // å»ºç«‹é€£çºŒå·¥ä½œå¤©æ•¸åˆ†ä½ˆåœ–
        function createConsecutiveDaysChart() {
            const ctx = document.getElementById('consecutiveDaysChart').getContext('2d');
            const dist = analysisResults.consecutiveDays.distribution;
            
            // æ’åºé€£çºŒå¤©æ•¸
            const sortedDays = Object.keys(dist).map(Number).sort((a, b) => a - b);
            const labels = sortedDays.map(d => `${d}å¤©`);
            const data = sortedDays.map(d => dist[d]);
            
            // è¨ˆç®—æ³•è¦ä¸Šé™ç·š
            const maxConsecutive = Math.max(...sortedDays);
            const limitLine = {
                id: 'limitLine',
                afterDatasetsDraw(chart) {
                    const {ctx, chartArea: {left, right, top, bottom}, scales: {x, y}} = chart;
                    const limitX = x.getPixelForValue(6); // 6å¤©æ³•è¦ä¸Šé™
                    
                    ctx.save();
                    ctx.strokeStyle = '#dc3545';
                    ctx.lineWidth = 2;
                    ctx.setLineDash([5, 5]);
                    ctx.beginPath();
                    ctx.moveTo(limitX, top);
                    ctx.lineTo(limitX, bottom);
                    ctx.stroke();
                    ctx.restore();
                    
                    // æ·»åŠ æ–‡å­—æ¨™ç±¤
                    ctx.save();
                    ctx.fillStyle = '#dc3545';
                    ctx.font = 'bold 12px Arial';
                    ctx.textAlign = 'center';
                    ctx.fillText('æ³•è¦ä¸Šé™ (6å¤©)', limitX, top - 10);
                    ctx.restore();
                }
            };
            
            charts.consecutiveDaysChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'äººæ•¸',
                        data: data,
                        backgroundColor: sortedDays.map(d => d <= 6 ? 'rgba(40, 167, 69, 0.7)' : 'rgba(220, 53, 69, 0.7)'),
                        borderColor: sortedDays.map(d => d <= 6 ? 'rgb(40, 167, 69)' : 'rgb(220, 53, 69)'),
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'äººæ•¸'
                            }
                        },
                        x: {
                            title: {
                                display: true,
                                text: 'é€£çºŒå·¥ä½œå¤©æ•¸'
                            }
                        }
                    }
                },
                plugins: [limitLine]
            });
        }
        
        // å»ºç«‹å¤œç­é »ç‡èˆ‡ç–²å‹é¢¨éšªé—œè¯åœ–
        function createNightShiftChart() {
            const ctx = document.getElementById('nightShiftChart').getContext('2d');
            const people = Object.values(analysisResults.people);
            
            // æº–å‚™æ•¸æ“š
            const nightShiftRatios = people.map(p => p.nightShiftRatio * 100); // è½‰æ›ç‚ºç™¾åˆ†æ¯”
            const friScores = people.map(p => p.friScore);
            
            charts.nightShiftChart = new Chart(ctx, {
                type: 'scatter',
                data: {
                    datasets: [{
                        label: 'äººå“¡',
                        data: nightShiftRatios.map((ratio, index) => ({
                            x: ratio,
                            y: friScores[index]
                        })),
                        backgroundColor: friScores.map(score => 
                            score >= 70 ? 'rgba(220, 53, 69, 0.7)' : 
                            score >= 50 ? 'rgba(255, 193, 7, 0.7)' : 
                            'rgba(40, 167, 69, 0.7)'
                        ),
                        borderColor: friScores.map(score => 
                            score >= 70 ? 'rgb(220, 53, 69)' : 
                            score >= 50 ? 'rgb(255, 193, 7)' : 
                            'rgb(40, 167, 69)'
                        ),
                        borderWidth: 1,
                        pointRadius: 8
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const person = people[context.dataIndex];
                                    return [
                                        `äººå“¡: ${person.name}`,
                                        `å¤œç­æ¯”ä¾‹: ${context.parsed.x.toFixed(1)}%`,
                                        `FRIåˆ†æ•¸: ${context.parsed.y}`
                                    ];
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 100,
                            title: {
                                display: true,
                                text: 'FRIåˆ†æ•¸'
                            }
                        },
                        x: {
                            beginAtZero: true,
                            max: 100,
                            title: {
                                display: true,
                                text: 'å¤œç­æ¯”ä¾‹ (%)'
                            }
                        }
                    }
                }
            });
        }
        
        // å»ºç«‹å·¥ä½œè² è·æ™‚é–“åºåˆ—åœ–
        function createWorkloadTrendChart() {
            const ctx = document.getElementById('workloadTrendChart').getContext('2d');
            
            // æ ¹æ“šå¯¦éš›æ•¸æ“šè¨ˆç®—æ¯æœˆå·¥ä½œé‡
            const monthlyWorkload = calculateMonthlyWorkload();
            const months = monthlyWorkload.map(m => m.month);
            const workloads = monthlyWorkload.map(m => m.workload);
            
            // è¨ˆç®—å¹³å‡å€¼
            const avgWorkload = workloads.reduce((a, b) => a + b, 0) / workloads.length;
            
            // è­˜åˆ¥å°–å³°æœˆä»½ï¼ˆé«˜æ–¼å¹³å‡20%ï¼‰
            const peakThreshold = avgWorkload * 1.2;
            
            charts.workloadTrendChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: months,
                    datasets: [
                        {
                            label: 'æ¯æœˆå·¥ä½œé‡',
                            data: workloads,
                            borderColor: '#1a3c8b',
                            backgroundColor: 'rgba(26, 60, 139, 0.1)',
                            borderWidth: 3,
                            fill: true,
                            tension: 0.3
                        },
                        {
                            label: 'å¹³å‡å·¥ä½œé‡',
                            data: Array(months.length).fill(avgWorkload),
                            borderColor: '#6c757d',
                            borderWidth: 1,
                            borderDash: [5, 5],
                            fill: false,
                            pointRadius: 0
                        },
                        {
                            label: 'å°–å³°é–¾å€¼',
                            data: Array(months.length).fill(peakThreshold),
                            borderColor: '#dc3545',
                            borderWidth: 1,
                            borderDash: [3, 3],
                            fill: false,
                            pointRadius: 0
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    plugins: {
                        legend: {
                            display: true,
                            position: 'top'
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'å·¥ä½œé‡ï¼ˆèˆªç­æ•¸ï¼‰'
                            }
                        },
                        x: {
                            title: {
                                display: true,
                                text: 'æœˆä»½'
                            }
                        }
                    }
                }
            });
        }
        
        // è¨ˆç®—æ¯æœˆå·¥ä½œé‡
        function calculateMonthlyWorkload() {
            // åˆå§‹åŒ–æœˆä»½å·¥ä½œé‡
            const monthlyWorkload = {};
            
            // è™•ç†åŸå§‹æ•¸æ“š
            rawData.forEach(record => {
                const dateStr = record.æ—¥æœŸ;
                const match = dateStr.match(/(\d{1,2})æœˆ/);
                if (match) {
                    const month = `${match[1]}æœˆ`;
                    monthlyWorkload[month] = (monthlyWorkload[month] || 0) + 1;
                }
            });
            
            // è½‰æ›ç‚ºé™£åˆ—ä¸¦æ’åº
            return Object.keys(monthlyWorkload)
                .map(month => ({ month, workload: monthlyWorkload[month] }))
                .sort((a, b) => {
                    const aMonth = parseInt(a.month);
                    const bMonth = parseInt(b.month);
                    return aMonth - bMonth;
                });
        }
        
        // å»ºç«‹ç­å‹åˆ†ä½ˆåœ–
        function createShiftTypeChart() {
            const ctx = document.getElementById('shiftTypeChart').getContext('2d');
            
            // æ”¶é›†æ‰€æœ‰ç­å‹æ•¸æ“š
            const shiftTypesData = { 'æ—©ç­': 0, 'æ™šç­': 0, 'å¤œç­': 0, 'æ—¥ç­': 0 };
            
            Object.values(analysisResults.people).forEach(person => {
                if (person.shiftTypes) {
                    Object.keys(person.shiftTypes).forEach(shiftType => {
                        if (shiftTypesData.hasOwnProperty(shiftType)) {
                            shiftTypesData[shiftType] += person.shiftTypes[shiftType];
                        } else {
                            shiftTypesData['æ—¥ç­'] += person.shiftTypes[shiftType];
                        }
                    });
                }
            });
            
            // å‰µå»ºåœ–è¡¨æ•¸æ“š
            const labels = [];
            const data = [];
            const backgroundColors = [];
            
            for (const [shiftType, count] of Object.entries(shiftTypesData)) {
                if (count > 0) {
                    labels.push(shiftType);
                    data.push(count);
                    
                    // æ ¹æ“šç­å‹è¨­å®šé¡è‰²
                    if (shiftType === 'å¤œç­') {
                        backgroundColors.push('rgba(220, 53, 69, 0.7)');
                    } else if (shiftType === 'æ—©ç­') {
                        backgroundColors.push('rgba(255, 193, 7, 0.7)');
                    } else if (shiftType === 'æ™šç­') {
                        backgroundColors.push('rgba(40, 167, 69, 0.7)');
                    } else {
                        backgroundColors.push('rgba(52, 152, 219, 0.7)');
                    }
                }
            }
            
            charts.shiftTypeChart = new Chart(ctx, {
                type: 'pie',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'èˆªç­æ•¸',
                        data: data,
                        backgroundColor: backgroundColors,
                        borderColor: backgroundColors.map(color => color.replace('0.7', '1')),
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    plugins: {
                        legend: {
                            position: 'right'
                        }
                    }
                }
            });
        }
        
        // åŒ¯å‡ºå ±å‘Š
        function exportReport() {
            alert('å®Œæ•´å ±å‘ŠåŒ¯å‡ºåŠŸèƒ½éœ€è¦å¾Œç«¯æ”¯æ´ã€‚\n\nç›®å‰å¯æä¾›çš„åŠŸèƒ½ï¼š\n1. æŒ‰ Ctrl+P åˆ—å°ç•¶å‰é é¢\n2. æˆªåœ–ä¿å­˜åˆ†æçµæœ\n\nå®Œæ•´ç‰ˆæœ¬å°‡æä¾›DOCXæ ¼å¼å ±å‘Šä¸‹è¼‰ã€‚');
        }
        
        // åŒ¯å‡ºSPSSæ ¼å¼è³‡æ–™
        function exportSPSSData() {
            // å»ºç«‹SPSSæ ¼å¼çš„è³‡æ–™
            let spssData = "äººå“¡\tå·¥ä½œå¤©æ•¸\tç¸½èˆªç­æ•¸\tå¹³å‡æ¯æ—¥èˆªç­\tæœ€å¤§é€£çºŒå·¥ä½œå¤©æ•¸\tå¤œç­æ¬¡æ•¸\tFRIåˆ†æ•¸\té¢¨éšªç­‰ç´š\n";
            
            analysisResults.workloadData.forEach(person => {
                const personObj = analysisResults.people[person.name];
                spssData += `${person.name}\t${person.workDays}\t${person.totalFlights}\t${person.avgFlights}\t${personObj.maxConsecutiveDays}\t${person.nightShifts}\t${person.friScore}\t${person.riskLevel}\n`;
            });
            
            const dataUri = 'data:text/tab-separated-values;charset=utf-8,' + encodeURIComponent(spssData);
            const linkElement = document.createElement('a');
            linkElement.setAttribute('href', dataUri);
            linkElement.setAttribute('download', 'ç–²å‹é¢¨éšªåˆ†æè³‡æ–™_SPSSæ ¼å¼.txt');
            linkElement.click();
        }
        
        // åŒ¯å‡ºåœ–è¡¨
        function exportCharts() {
            alert('åœ–è¡¨åŒ¯å‡ºåŠŸèƒ½éœ€è¦é¡å¤–çš„åº«æ”¯æ´ã€‚\n\nç›®å‰è«‹ä½¿ç”¨ç€è¦½å™¨æˆªåœ–åŠŸèƒ½ï¼ˆCtrl+Shift+Sï¼‰æˆ–æŒ‰Ctrl+Påˆ—å°é é¢ã€‚');
        }
        
        // é‡ç½®åˆ†æ
        function resetAnalysis() {
            if (confirm('ç¢ºå®šè¦é‡æ–°é–‹å§‹åˆ†æå—ï¼Ÿæ‰€æœ‰ç•¶å‰åˆ†æçµæœå°‡æœƒè¢«æ¸…é™¤ã€‚')) {
                rawData = [];
                analysisResults = {};
                chartDetailInfo = {};
                
                // æ¸…é™¤åœ–è¡¨
                Object.values(charts).forEach(chart => {
                    if (chart) chart.destroy();
                });
                charts = {};
                
                // éš±è—åˆ†æå€æ®µ
                analysisResultsSection.classList.add('hidden');
                dataPreviewContainer.classList.add('hidden');
                loadingIndicator.classList.add('hidden');
                
                // é‡ç½®æª”æ¡ˆè¼¸å…¥
                fileInput.value = '';
                
                // é‡æ–°é¡¯ç¤ºä¸Šå‚³å€åŸŸ
                dropArea.style.display = 'block';
                
                alert('ç³»çµ±å·²é‡ç½®ï¼Œå¯ä»¥é‡æ–°ä¸Šå‚³æª”æ¡ˆé€²è¡Œåˆ†æã€‚');
            }
        }
        
        // ==================== è¼”åŠ©å‡½æ•¸ ====================
        
        // åˆ¤æ–·æ˜¯å¦ç‚ºæœ‰æ•ˆäººå
        function isValidPersonName(name) {
            if (!name) return false;
            const trimmed = name.trim();
            if (trimmed.length < 2 || trimmed.length > 10) return false;
            if (/^\d+$/.test(trimmed)) return false;
            if (/[-_=]{2,}/.test(trimmed)) return false;
            
            const chinese = /^[\u4e00-\u9fa5]+$/;
            const english = /^[A-Za-z\s]+$/;
            
            return chinese.test(trimmed) || english.test(trimmed);
        }
        
        // åˆ¤æ–·æ˜¯å¦ç‚ºé–å¹´
        function isLeapYear(year) {
            return (year % 4 === 0 && year % 100 !== 0) || (year % 400 === 0);
        }
        
        // å¾è³‡æ–™ä¸­æ¨æ–·å¹´ä»½
        function inferYearFromData(data) {
            // æª¢æŸ¥æ˜¯å¦æœ‰2æœˆ29æ—¥çš„è¨˜éŒ„
            const hasFeb29 = data.some(record => {
                const dateStr = record.æ—¥æœŸ;
                return dateStr && dateStr.includes('2æœˆ29æ—¥');
            });
            
            if (hasFeb29) {
                // æœ‰2æœˆ29æ—¥ï¼Œè¡¨ç¤ºæ˜¯é–å¹´
                const currentYear = new Date().getFullYear();
                for (let year = currentYear; year >= 2000; year--) {
                    if (isLeapYear(year)) {
                        return year;
                    }
                }
                return 2024; // é è¨­ä½¿ç”¨2024å¹´ï¼ˆæœ€è¿‘çš„ä¸€å€‹é–å¹´ï¼‰
            } else {
                // æ²’æœ‰2æœˆ29æ—¥ï¼Œä½¿ç”¨ç•¶å‰å¹´ä»½
                return new Date().getFullYear();
            }
        }
        
        // è§£æä¸­æ–‡æ—¥æœŸç‚ºæ¨™æº–æ—¥æœŸå°è±¡
        function parseChineseDateToStandard(dateStr) {
            if (!dateStr) return null;
            
            const year = inferredYear;
            const match = dateStr.match(/(\d{1,2})æœˆ(\d{1,2})æ—¥/);
            if (match) {
                const month = parseInt(match[1]);
                const day = parseInt(match[2]);
                
                // å‰µå»ºæ—¥æœŸå°è±¡
                const date = new Date(year, month - 1, day);
                
                // æª¢æŸ¥æ—¥æœŸæ˜¯å¦æœ‰æ•ˆ
                if (date.getMonth() + 1 !== month || date.getDate() !== day) {
                    // å°æ–¼ç„¡æ•ˆæ—¥æœŸï¼Œèª¿æ•´ç‚ºè©²æœˆçš„æœ€å¾Œä¸€å¤©
                    return new Date(year, month, 0);
                }
                
                return date;
            }
            
            return null;
        }
        
        // å–å¾—ç­å‹
        function getShiftType(record) {
            const timeStr = record.STA || record.STD;
            if (!timeStr) return 'æ—¥ç­';
            
            // è™•ç†æ™‚é–“æ ¼å¼å¦‚ "1505" -> 15:05
            const trimmed = timeStr.toString().trim();
            if (trimmed.length >= 4) {
                const hour = parseInt(trimmed.substring(0, 2));
                
                if (hour >= 22 || hour < 6) return 'å¤œç­';
                else if (hour >= 6 && hour < 14) return 'æ—©ç­';
                else if (hour >= 14 && hour < 22) return 'æ™šç­';
            }
            
            return 'æ—¥ç­';
        }
    </script>
</body>
    </html>
